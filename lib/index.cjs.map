{"version":3,"sources":["../src/index.ts","../src/server.ts","../src/api.ts","../src/utils/a_bogus.ts","../src/utils/index.ts"],"sourcesContent":["import { startServer } from './server.js';\n// å¯¼å‡ºAPIå‡½æ•°ä¾›æµ‹è¯•ä½¿ç”¨\nexport { generateImage, generateVideo, ASPECT_RATIO_PRESETS, ImageDimensionCalculator } from './api.js';\n\n// å¤„ç†æœªæ•è·çš„å¼‚å¸¸\nprocess.on('uncaughtException', (error) => {\n  console.error('æœªæ•è·çš„å¼‚å¸¸:', error);\n});\n\n// å¤„ç†æœªå¤„ç†çš„Promiseæ‹’ç»\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', reason);\n});\n\n// å¯åŠ¨æœåŠ¡å™¨\nconst main = async () => {\n  try {\n    // required: JIMENG_API_TOKEN\n    if (!process.env.JIMENG_API_TOKEN) {\n      throw new Error('JIMENG_API_TOKEN is required!')\n    }\n\n    await startServer();\n  } catch (error) {\n    console.error('å¯åŠ¨æœåŠ¡å™¨æ—¶å‡ºé”™:', error);\n    process.exit(1);\n  }\n};\n\n// åªæœ‰åœ¨ç›´æ¥è¿è¡Œæ—¶æ‰å¯åŠ¨æœåŠ¡å™¨\nif (import.meta.url === `file://${process.argv[1]}`) {\n  main();\n} ","import { McpServer, ResourceTemplate } from \"@modelcontextprotocol/sdk/server/mcp.js\";\nimport { StdioServerTransport } from \"@modelcontextprotocol/sdk/server/stdio.js\";\nimport { z } from \"zod\";\nimport { generateImage, generateVideo, frameInterpolation, superResolution } from \"./api.js\";\n\n// ğŸš€ [MCP DEBUG] Server startup logging\nconsole.error('ğŸš€ [MCP DEBUG] server.ts loaded at:', new Date().toISOString());\nconsole.error('ğŸš€ [MCP DEBUG] Node.js version:', process.version);\nconsole.error('ğŸš€ [MCP DEBUG] Working directory:', process.cwd());\nconsole.error('ğŸš€ [MCP DEBUG] Environment token available:', !!process.env.JIMENG_API_TOKEN);\nconsole.error('ğŸš€ [MCP DEBUG] Environment token length:', process.env.JIMENG_API_TOKEN?.length || 'N/A');\n\n// å®šä¹‰æœåŠ¡å™¨è¿”å›ç±»å‹æ¥å£\nexport interface ServerInstance {\n  server: McpServer;\n  transport: StdioServerTransport;\n}\n\n// åˆ›å»ºMCPæœåŠ¡å™¨\nexport const createServer = (): McpServer => {\n  console.error('ğŸš€ [MCP DEBUG] Creating MCP server instance...');\n  \n  const server = new McpServer({\n    name: \"Jimeng MCP Server\",\n    version: \"1.0.0\"\n  });\n  \n  console.error('ğŸš€ [MCP DEBUG] MCP server instance created successfully');\n\n  // æ·»åŠ ä¸€ä¸ªç®€å•çš„é—®å€™å·¥å…·\n  // åŠŸèƒ½ï¼šæµ‹è¯•è¿æ¥å’ŒåŸºæœ¬åŠŸèƒ½\n  server.tool(\n    \"hello\",\n    { name: z.string().describe(\"è¦é—®å€™çš„å§“å\") },\n    async ({ name }) => ({\n      content: [{ type: \"text\", text: `ä½ å¥½ï¼Œ${name}ï¼` }]\n    })\n  );\n\n  // æ·»åŠ å³æ¢¦AIå›¾åƒç”Ÿæˆå·¥å…·\n  // åŠŸèƒ½ï¼šä½¿ç”¨å³æ¢¦AIç”Ÿæˆé«˜è´¨é‡å›¾åƒï¼Œæ”¯æŒå¤šç§æ¨¡å‹å’Œå‚è€ƒå›¾æ··åˆ\n  // æ”¯æŒçš„æ¨¡å‹ï¼šjimeng-4.0(æœ€æ–°), jimeng-3.0, jimeng-2.1, jimeng-2.0-pro, jimeng-2.0, jimeng-1.4, jimeng-xl-pro\n  // \n  // ğŸ”¥ å…³é”®æŠ€å·§ï¼š\n  // 1. åœ¨æç¤ºè¯ä¸­æ˜ç¡®æŒ‡å®šéœ€è¦ç”Ÿæˆçš„å›¾ç‰‡æ•°é‡ï¼Œå¦‚\"ç”Ÿæˆ4å¼ ä¸åŒè§’åº¦çš„çŒ«å’ªå›¾ç‰‡\"\n  // 2. ä½¿ç”¨è¯¦ç»†çš„æè¿°è¯æé«˜è´¨é‡ï¼šé£æ ¼ã€å…‰çº¿ã€æ„å›¾ã€è‰²å½©ç­‰ï¼Œå¦‚\"ç”µå½±çº§å…‰çº¿ï¼Œé«˜æ¸…ç»†èŠ‚\"\n  // 3. jimeng-4.0æ¨¡å‹æ•ˆæœæœ€ä½³ï¼Œé€‚åˆå¤æ‚åœºæ™¯ï¼›jimeng-3.0é€‚åˆè‰ºæœ¯é£æ ¼\n  // 4. å‚è€ƒå›¾æ··åˆæ—¶ï¼Œsample_strengthæ§åˆ¶å‚è€ƒç¨‹åº¦ï¼š0.3-0.5ä¿ç•™åŸå›¾ç‰¹å¾ï¼Œ0.7-0.9åˆ›æ„å˜åŒ–å¤§\n  // 5. åå‘æç¤ºè¯é¿å…ä¸éœ€è¦çš„å…ƒç´ ï¼Œå¦‚\"æ¨¡ç³Šï¼Œä½è´¨é‡ï¼Œå˜å½¢ï¼Œå¤šä½™çš„æ‰‹æŒ‡\"\n  // \n  // ğŸ“ å®½é«˜æ¯”é¢„è®¾ä½¿ç”¨æŒ‡å—ï¼š\n  // â€¢ 'auto' (æ™ºèƒ½): ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„å°ºå¯¸ (1024x1024)\n  // â€¢ '21:9': è¶…å®½å±å¹•æ¯”ä¾‹ï¼Œé€‚åˆç”µå½±çº§æ¨ªå‘åœºæ™¯ (3024x1296)\n  // â€¢ '16:9': æ ‡å‡†å®½å±æ¯”ä¾‹ï¼Œé€‚åˆæ¨ªå‘é£æ™¯ã€è§†é¢‘ç¼©ç•¥å›¾ (2560x1440)\n  // â€¢ '3:2': ä¼ ç»Ÿæ‘„å½±æ¯”ä¾‹ï¼Œé€‚åˆç›¸æœºæ‹æ‘„æ•ˆæœ (2496x1664)\n  // â€¢ '4:3': ç»å…¸æ˜¾ç¤ºå™¨æ¯”ä¾‹ï¼Œé€‚åˆä¼ ç»Ÿæ„å›¾ (2304x1728)\n  // â€¢ '1:1': æ–¹å½¢æ¯”ä¾‹ï¼Œé€‚åˆå¤´åƒã€Instagramå›¾ç‰‡ (2048x2048)\n  // â€¢ '3:4': ç«–å‘ä¼ ç»Ÿæ¯”ä¾‹ï¼Œé€‚åˆè‚–åƒæ‘„å½± (1728x2304)\n  // â€¢ '2:3': ç»å…¸ç«–å‘æ¯”ä¾‹ï¼Œé€‚åˆä¹¦ç±å°é¢ (1664x2496)\n  // â€¢ '9:16': ç«–å±æ¯”ä¾‹ï¼Œé€‚åˆæ‰‹æœºå£çº¸ã€æŠ–éŸ³è§†é¢‘ (1440x2560)\n  console.error('ğŸš€ [MCP DEBUG] Registering generateImage tool...');\n  \n  server.tool(\n    \"generateImage\",\n    {\n      filePath: z.string().optional().describe(\"æœ¬åœ°å›¾ç‰‡è·¯å¾„æˆ–å›¾ç‰‡URLï¼ˆå¯é€‰ï¼Œè‹¥å¡«å†™åˆ™ä¸ºå›¾ç‰‡æ··åˆ/å‚è€ƒå›¾ç”ŸæˆåŠŸèƒ½ï¼‰\"),\n      prompt: z.string().describe(\"ç”Ÿæˆå›¾åƒçš„æ–‡æœ¬æè¿°\"),\n      model: z.string().optional().describe(\"æ¨¡å‹åç§°ï¼Œå¯é€‰å€¼: jimeng-4.0,jimeng-3.0, jimeng-2.1, jimeng-2.0-pro, jimeng-2.0, jimeng-1.4, jimeng-xl-pro\"),\n      aspectRatio: z.string().optional().default(\"auto\").describe(\"å®½é«˜æ¯”é¢„è®¾ï¼Œæ”¯æŒä»¥ä¸‹é€‰é¡¹: auto(æ™ºèƒ½), 21:9(è¶…å®½å±), 16:9(æ ‡å‡†å®½å±), 3:2(æ‘„å½±), 4:3(ä¼ ç»Ÿ), 1:1(æ­£æ–¹å½¢), 3:4(ç«–å±), 2:3(ä¹¦ç±), 9:16(æ‰‹æœºç«–å±)\"),\n      sample_strength: z.number().min(0).max(1).optional().default(0.5).describe(\"ç²¾ç»†åº¦ï¼ŒèŒƒå›´0-1ï¼Œé»˜è®¤0.5ã€‚æ•°å€¼è¶Šå°è¶Šæ¥è¿‘å‚è€ƒå›¾\"),\n      negative_prompt: z.string().optional().default(\"\").describe(\"åå‘æç¤ºè¯ï¼Œå‘Šè¯‰æ¨¡å‹ä¸è¦ç”Ÿæˆä»€ä¹ˆå†…å®¹\"),\n    },\n    async (params) => {\n      // ğŸ”¥ [MCP DEBUG] Tool call entry point - this is the CRITICAL debugging point\n      console.error('ğŸ”¥ [MCP DEBUG] =================================');\n      console.error('ğŸ”¥ [MCP DEBUG] generateImage tool called!');\n      console.error('ğŸ”¥ [MCP DEBUG] Timestamp:', new Date().toISOString());\n      console.error('ğŸ”¥ [MCP DEBUG] Raw params received:', JSON.stringify(params, null, 2));\n      console.error('ğŸ”¥ [MCP DEBUG] =================================');\n      try {\n        // ğŸ” Debug logging - è®°å½•MCPæ¥æ”¶åˆ°çš„åŸå§‹å‚æ•°\n        console.log('ğŸ” [MCP Server] Received raw parameters:', JSON.stringify(params, null, 2));\n        \n        // ğŸ” Debug logging - è®°å½•ç¯å¢ƒå˜é‡çŠ¶æ€\n        const hasToken = !!process.env.JIMENG_API_TOKEN;\n        console.log('ğŸ” [MCP Server] Environment token available:', hasToken);\n        if (hasToken) {\n          console.log('ğŸ” [MCP Server] Token length:', process.env.JIMENG_API_TOKEN?.length);\n        }\n        \n        // ğŸ” Debug logging - è®°å½•å‚æ•°éªŒè¯åçš„çŠ¶æ€\n        console.log('ğŸ” [MCP Server] Validated parameters for API call:');\n        console.log('  - filePath:', params.filePath || 'undefined');\n        console.log('  - prompt:', params.prompt ? `\"${params.prompt.substring(0, 50)}...\"` : 'undefined');\n        console.log('  - model:', params.model || 'undefined');\n        console.log('  - aspectRatio:', params.aspectRatio || 'undefined');\n        console.log('  - sample_strength:', params.sample_strength);\n        console.log('  - negative_prompt:', params.negative_prompt || 'empty');\n\n        const imageUrls = await generateImage({\n          filePath: params.filePath,\n          prompt: params.prompt,\n          model: params.model,\n          aspectRatio: params.aspectRatio,\n          sample_strength: params.sample_strength,\n          negative_prompt: params.negative_prompt\n        });\n\n        // å¦‚æœæ²¡æœ‰è¿”å›URLæ•°ç»„ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯\n        if (!imageUrls || (Array.isArray(imageUrls) && imageUrls.length === 0)) {\n          return {\n            content: [{ type: \"text\", text: \"å›¾åƒç”Ÿæˆå¤±è´¥ï¼šæœªèƒ½è·å–å›¾åƒURL\" }],\n            isError: true\n          };\n        }\n\n\n        // å°†è¿”å›çš„å›¾åƒURLè½¬æ¢ä¸ºMCPå“åº”æ ¼å¼\n        // ä½¿ç”¨å•ä¸ªæ–‡æœ¬å†…å®¹ï¼Œæ¯è¡Œä¸€ä¸ªURLï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯è§£æ\n        let responseText = '';\n        \n        if (typeof imageUrls === 'string') {\n          // å•ä¸ªURLçš„æƒ…å†µ\n          responseText = imageUrls;\n        } else if (Array.isArray(imageUrls)) {\n          // URLæ•°ç»„çš„æƒ…å†µï¼Œæ¯è¡Œä¸€ä¸ªURL\n          responseText = imageUrls.join('\\n');\n        }\n\n        return {\n          content: [{\n            type: \"text\",\n            text: responseText\n          }]\n        };\n      } catch (error) {\n        // ğŸ” Debug logging - è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯\n        console.error('ğŸ” [MCP Server] Error caught in generateImage tool:');\n        console.error('ğŸ” [MCP Server] Error type:', error?.constructor?.name);\n        console.error('ğŸ” [MCP Server] Error message:', error instanceof Error ? error.message : String(error));\n        if (error instanceof Error && error.stack) {\n          console.error('ğŸ” [MCP Server] Error stack:', error.stack);\n        }\n        \n        // ğŸ” è®°å½•é”™è¯¯æ—¶çš„å‚æ•°çŠ¶æ€\n        console.error('ğŸ” [MCP Server] Parameters when error occurred:', JSON.stringify({\n          filePath: params.filePath,\n          prompt: params.prompt ? `${params.prompt.substring(0, 100)}...` : undefined,\n          model: params.model,\n          aspectRatio: params.aspectRatio,\n          sample_strength: params.sample_strength,\n          negative_prompt: params.negative_prompt\n        }, null, 2));\n        \n        const errorMessage = error instanceof Error ? error.message : String(error);\n        return {\n          content: [{ type: \"text\", text: `å›¾åƒç”Ÿæˆå¤±è´¥: ${errorMessage}` }],\n          isError: true\n        };\n      }\n    }\n  );\n  \n  console.error('ğŸš€ [MCP DEBUG] generateImage tool registered successfully');\n\n  // æ·»åŠ å³æ¢¦AIè§†é¢‘ç”Ÿæˆå·¥å…·\n  // åŠŸèƒ½ï¼šç”ŸæˆAIè§†é¢‘ï¼Œæ”¯æŒä¼ ç»Ÿæ¨¡å¼ï¼ˆé¦–å°¾å¸§ï¼‰å’Œæ™ºèƒ½å¤šå¸§æ¨¡å¼\n  // ä¼ ç»Ÿæ¨¡å¼ï¼šä½¿ç”¨1-2å¼ å›¾ç‰‡ä½œä¸ºé¦–å°¾å¸§ç”Ÿæˆè§†é¢‘\n  // æ™ºèƒ½å¤šå¸§æ¨¡å¼ï¼šä½¿ç”¨å¤šä¸ªå…³é”®å¸§ï¼ˆæœ€å¤š10å¸§ï¼‰ç”Ÿæˆæ›´å¤æ‚çš„è§†é¢‘ï¼Œæ¯å¸§å¯è‡ªå®šä¹‰æ—¶é•¿å’Œæç¤ºè¯\n  // æ”¯æŒ720p/1080påˆ†è¾¨ç‡ï¼Œ9:16/16:9ç­‰å¤šç§æ¯”ä¾‹\n  //\n  // ğŸ”¥ å…³é”®æŠ€å·§ï¼š\n  // 1. å¤šå¸§æ¨¡å¼ï¼šåˆç†åˆ†é…å¸§æ—¶é•¿ï¼Œå»ºè®®æ¯å¸§2-3ç§’ï¼Œæ€»æ—¶é•¿10ç§’å†…æ•ˆæœæœ€ä½³\n  // 2. æç¤ºè¯ä¸€è‡´æ€§ï¼šä¿æŒä¸»ä½“å’Œé£æ ¼ç»Ÿä¸€ï¼Œå¦‚\"åŒä¸€ä¸ªäººç‰©ï¼Œç›¸åŒçš„æœè£…å’Œå‘å‹\"\n  // 3. åœºæ™¯è½¬æ¢ï¼šä½¿ç”¨è¿‡æ¸¡è¯è¯­ï¼Œå¦‚\"ç¼“ç¼“è½¬å‘\"ã€\"å¹³æ»‘ç§»åŠ¨åˆ°\"ï¼Œé¿å…çªå…€è·³è·ƒ\n  // 4. æ¯”ä¾‹é€‰æ‹©ï¼š9:16é€‚åˆçŸ­è§†é¢‘å¹³å°ï¼Œ16:9é€‚åˆæ¨ªå±è§‚çœ‹ï¼Œ3:4é€‚åˆäº§å“å±•ç¤º\n  // 5. è¿åŠ¨å¹…åº¦ï¼šé¿å…è¿‡å¤§çš„åŠ¨ä½œå˜åŒ–ï¼Œç»†å¾®çš„åŠ¨ä½œæ›´è‡ªç„¶æµç•…\n  // 6. å…‰çº¿ä¸€è‡´ï¼šä¿æŒç»Ÿä¸€çš„å…‰ç…§æ¡ä»¶ï¼Œé¿å…æ˜æš—å˜åŒ–è¿‡å¤§\n  server.tool(\n    \"generateVideo\",\n    {\n      filePath: z.array(z.string()).optional().describe(\"é¦–å¸§å’Œå°¾å¸§å›¾ç‰‡è·¯å¾„ï¼Œæ”¯æŒæ•°ç»„ï¼Œæœ€å¤š2ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«ä¸ºé¦–å¸§å’Œå°¾å¸§ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰\"),\n      multiFrames: z.array(z.object({\n        idx: z.number().describe(\"å¸§ç´¢å¼•\"),\n        duration_ms: z.number().min(1000).max(5000).describe(\"å¸§æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼ŒèŒƒå›´ï¼š1000-5000msï¼Œå³1-5ç§’ï¼‰\"),\n        prompt: z.string().describe(\"è¯¥å¸§çš„æç¤ºè¯\"),\n        image_path: z.string().describe(\"è¯¥å¸§çš„å›¾ç‰‡è·¯å¾„\")\n      })).max(10).optional().describe(\"æ™ºèƒ½å¤šå¸§é…ç½®ï¼Œæ”¯æŒå¤šä¸ªå…³é”®å¸§ï¼ˆæœ€å¤š10å¸§ï¼‰\"),\n      resolution: z.string().optional().describe(\"åˆ†è¾¨ç‡ï¼Œå¯é€‰720pæˆ–1080pï¼Œé»˜è®¤720p\"),\n      model: z.string().optional().describe(\"æ¨¡å‹åç§°ï¼Œä¼ ç»Ÿæ¨¡å¼é»˜è®¤jimeng-video-3.0ï¼Œå¤šå¸§æ¨¡å¼é»˜è®¤jimeng-video-multiframe\"),\n      prompt: z.string().describe(\"ç”Ÿæˆè§†é¢‘çš„æ–‡æœ¬æè¿°ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰æˆ–å…¨å±€æç¤ºè¯ï¼ˆå¤šå¸§æ¨¡å¼ï¼‰\"),\n      width: z.number().min(512).max(2560).optional().default(1024).describe(\"è§†é¢‘å®½åº¦ï¼ŒèŒƒå›´512-2560ï¼Œé»˜è®¤1024\"),\n      height: z.number().min(512).max(2560).optional().default(1024).describe(\"è§†é¢‘é«˜åº¦ï¼ŒèŒƒå›´512-2560ï¼Œé»˜è®¤1024\"),\n      fps: z.number().min(12).max(30).optional().default(24).describe(\"å¸§ç‡ï¼ŒèŒƒå›´12-30ï¼Œé»˜è®¤24ï¼ˆå¤šå¸§æ¨¡å¼ï¼‰\"),\n      duration_ms: z.number().min(3000).max(15000).optional().describe(\"æ€»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼ŒèŒƒå›´3000-15000msï¼Œå¤šå¸§æ¨¡å¼ï¼‰\"),\n      video_aspect_ratio: z.string().optional().describe(\"è§†é¢‘æ¯”ä¾‹ï¼Œå¦‚'3:4'ï¼ˆå¤šå¸§æ¨¡å¼ï¼‰\"),\n      refresh_token: z.string().optional().describe(\"å³æ¢¦APIä»¤ç‰Œï¼ˆå¯é€‰ï¼Œé€šå¸¸ä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰\"),\n      req_key: z.string().optional().describe(\"è‡ªå®šä¹‰å‚æ•°ï¼Œå…¼å®¹æ—§æ¥å£\")\n    },\n    async (params) => {\n      try {\n        const videoUrl = await generateVideo({\n          filePath: params.filePath,\n          multiFrames: params.multiFrames,\n          resolution: params.resolution,\n          model: params.model,\n          prompt: params.prompt,\n          width: params.width,\n          height: params.height,\n          fps: params.fps,\n          duration_ms: params.duration_ms,\n          video_aspect_ratio: params.video_aspect_ratio,\n          refresh_token: params.refresh_token,\n          req_key: params.req_key\n        });\n        if (!videoUrl) {\n          return {\n            content: [{ type: \"text\", text: \"è§†é¢‘ç”Ÿæˆå¤±è´¥ï¼šæœªèƒ½è·å–è§†é¢‘URL\" }],\n            isError: true\n          };\n        }\n        return {\n          content: [{ type: \"text\", text: videoUrl }]\n        };\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        return {\n          content: [{ type: \"text\", text: `è§†é¢‘ç”Ÿæˆå¤±è´¥: ${errorMessage}` }],\n          isError: true\n        };\n      }\n    }\n  );\n\n  // æ·»åŠ è§†é¢‘è¡¥å¸§å·¥å…·\n  // åŠŸèƒ½ï¼šå¯¹å·²ç”Ÿæˆçš„è§†é¢‘è¿›è¡Œè¡¥å¸§å¤„ç†ï¼Œæå‡è§†é¢‘æµç•…åº¦\n  // æ”¯æŒå°†24fpsè§†é¢‘æå‡è‡³30fpsæˆ–60fpsï¼Œè®©è§†é¢‘æ’­æ”¾æ›´åŠ æµç•…è‡ªç„¶\n  // éœ€è¦æä¾›åŸå§‹è§†é¢‘çš„videoIdå’Œç”Ÿæˆå†å²ID\n  //\n  // ğŸ”¥ å…³é”®æŠ€å·§ï¼š\n  // 1. å¸§ç‡é€‰æ‹©ï¼š30fpsé€‚åˆå¸¸è§„è§‚çœ‹ï¼Œ60fpsé€‚åˆè¿åŠ¨åœºæ™¯æˆ–é«˜è¦æ±‚åœºæ™¯\n  // 2. åŸè§†é¢‘è´¨é‡ï¼šç¡®ä¿åŸè§†é¢‘åŠ¨ä½œè¿è´¯ï¼Œé¿å…è·³è·ƒå¼å˜åŒ–å½±å“è¡¥å¸§æ•ˆæœ\n  // 3. å¤„ç†é¡ºåºï¼šå»ºè®®å…ˆå®Œæˆåˆ†è¾¨ç‡æå‡ï¼Œå†è¿›è¡Œè¡¥å¸§å¤„ç†ï¼Œæ•ˆæœæ›´ä½³\n  // 4. é€‚ç”¨åœºæ™¯ï¼šäººç‰©åŠ¨ä½œã€ç›¸æœºç§»åŠ¨ã€è‡ªç„¶åœºæ™¯å˜åŒ–ç­‰è¿ç»­æ€§å¼ºçš„è§†é¢‘æ•ˆæœæœ€å¥½\n  server.tool(\n    \"frameInterpolation\",\n    {\n      videoId: z.string().describe(\"è§†é¢‘ID\"),\n      originHistoryId: z.string().describe(\"åŸå§‹ç”Ÿæˆå†å²ID\"),\n      targetFps: z.union([z.literal(30), z.literal(60)]).describe(\"ç›®æ ‡å¸§ç‡ï¼š30æˆ–60fps\"),\n      originFps: z.number().describe(\"åŸå§‹å¸§ç‡\"),\n      duration: z.number().optional().describe(\"è§†é¢‘æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œå¯é€‰\")\n    },\n    async (params) => {\n      try {\n        const videoUrl = await frameInterpolation({\n          videoId: params.videoId,\n          originHistoryId: params.originHistoryId,\n          targetFps: params.targetFps,\n          originFps: params.originFps,\n          duration: params.duration\n        });\n        \n        if (!videoUrl) {\n          return {\n            content: [{ type: \"text\", text: \"è§†é¢‘è¡¥å¸§å¤±è´¥ï¼šæœªèƒ½è·å–å¤„ç†åçš„è§†é¢‘URL\" }],\n            isError: true\n          };\n        }\n        \n        return {\n          content: [{ type: \"text\", text: videoUrl }]\n        };\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        return {\n          content: [{ type: \"text\", text: `è§†é¢‘è¡¥å¸§å¤±è´¥: ${errorMessage}` }],\n          isError: true\n        };\n      }\n    }\n  );\n\n  // æ·»åŠ è§†é¢‘åˆ†è¾¨ç‡æå‡å·¥å…·\n  // åŠŸèƒ½ï¼šå¯¹å·²ç”Ÿæˆçš„è§†é¢‘è¿›è¡Œåˆ†è¾¨ç‡æå‡å¤„ç†ï¼Œå¢å¼ºè§†é¢‘ç”»è´¨å’Œæ¸…æ™°åº¦\n  // å¯å°†ä½åˆ†è¾¨ç‡è§†é¢‘æå‡è‡³æ›´é«˜åˆ†è¾¨ç‡ï¼ˆå¦‚704x1248 â†’ 1408x2496ï¼‰ï¼Œæä¾›æ›´æ¸…æ™°çš„è§†è§‰æ•ˆæœ\n  // éœ€è¦æä¾›åŸå§‹è§†é¢‘çš„videoIdã€ç”Ÿæˆå†å²IDä»¥åŠåŸå§‹å’Œç›®æ ‡åˆ†è¾¨ç‡å‚æ•°\n  //\n  // ğŸ”¥ å…³é”®æŠ€å·§ï¼š\n  // 1. åˆ†è¾¨ç‡é™åˆ¶ï¼šç›®æ ‡åˆ†è¾¨ç‡èŒƒå›´768-2560åƒç´ ï¼ˆå®½æˆ–é«˜ï¼‰\n  // 2. å€æ•°å…³ç³»ï¼šå»ºè®®æŒ‰2å€æå‡ï¼Œå¦‚720pâ†’1440pï¼Œæ•ˆæœæœ€ä½³ï¼Œé¿å…å¥‡æ•°å€\n  // 3. æ¯”ä¾‹ä¿æŒï¼šç¡®ä¿ç›®æ ‡åˆ†è¾¨ç‡ä¸åŸå§‹æ¯”ä¾‹ä¸€è‡´ï¼Œé¿å…ç”»é¢æ‹‰ä¼¸å˜å½¢\n  // 4. åŸè§†é¢‘è´¨é‡ï¼šåŸè§†é¢‘è¶Šæ¸…æ™°ï¼Œåˆ†è¾¨ç‡æå‡æ•ˆæœè¶Šå¥½ï¼Œæ¨¡ç³Šè§†é¢‘æå‡æœ‰é™\n  // 5. å†…å®¹é€‚ç”¨æ€§ï¼šäººç‰©ã€é£æ™¯ã€äº§å“å±•ç¤ºç±»è§†é¢‘æå‡æ•ˆæœæ˜æ˜¾ï¼ŒæŠ½è±¡å†…å®¹æ•ˆæœæœ‰é™\n  server.tool(\n    \"superResolution\",\n    {\n      videoId: z.string().describe(\"è§†é¢‘ID\"),\n      originHistoryId: z.string().describe(\"åŸå§‹ç”Ÿæˆå†å²ID\"),\n      targetWidth: z.number().min(768).max(2560).describe(\"ç›®æ ‡å®½åº¦ï¼ŒèŒƒå›´768-2560åƒç´ \"),\n      targetHeight: z.number().min(768).max(2560).describe(\"ç›®æ ‡é«˜åº¦ï¼ŒèŒƒå›´768-2560åƒç´ \"),\n      originWidth: z.number().describe(\"åŸå§‹å®½åº¦\"),\n      originHeight: z.number().describe(\"åŸå§‹é«˜åº¦\")\n    },\n    async (params) => {\n      try {\n        const videoUrl = await superResolution({\n          videoId: params.videoId,\n          originHistoryId: params.originHistoryId,\n          targetWidth: params.targetWidth,\n          targetHeight: params.targetHeight,\n          originWidth: params.originWidth,\n          originHeight: params.originHeight\n        });\n        \n        if (!videoUrl) {\n          return {\n            content: [{ type: \"text\", text: \"è§†é¢‘åˆ†è¾¨ç‡æå‡å¤±è´¥ï¼šæœªèƒ½è·å–å¤„ç†åçš„è§†é¢‘URL\" }],\n            isError: true\n          };\n        }\n        \n        return {\n          content: [{ type: \"text\", text: videoUrl }]\n        };\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        return {\n          content: [{ type: \"text\", text: `è§†é¢‘åˆ†è¾¨ç‡æå‡å¤±è´¥: ${errorMessage}` }],\n          isError: true\n        };\n      }\n    }\n  );\n\n  // æ·»åŠ ä¸€ä¸ªé—®å€™èµ„æº\n  server.resource(\n    \"greeting\",\n    new ResourceTemplate(\"greeting://{name}\", { list: undefined }),\n    async (uri, { name }) => ({\n      contents: [{\n        uri: uri.href,\n        text: `æ¬¢è¿ä½¿ç”¨Jimeng MCPæœåŠ¡å™¨ï¼Œ${name}ï¼`\n      }]\n    })\n  );\n\n  // æ·»åŠ ä¸€ä¸ªé™æ€ä¿¡æ¯èµ„æº\n  server.resource(\n    \"info\",\n    \"info://server\",\n    async (uri) => ({\n      contents: [{\n        uri: uri.href,\n        text: `\n            Jimeng MCP æœåŠ¡å™¨\n            ç‰ˆæœ¬: 1.0.0\n            è¿è¡Œäº: ${process.platform}\n            Nodeç‰ˆæœ¬: ${process.version}\n        `\n      }]\n    })\n  );\n\n  // æ·»åŠ å³æ¢¦AIå›¾åƒç”ŸæˆæœåŠ¡ä¿¡æ¯èµ„æº\n  server.resource(\n    \"jimeng-ai\",\n    \"jimeng-ai://info\",\n    async (uri) => ({\n      contents: [{\n        uri: uri.href,\n        text: `\n          å³æ¢¦AIå›¾åƒç”ŸæˆæœåŠ¡\n          -----------------\n          é€šè¿‡ä½¿ç”¨ generateImage å·¥å…·æäº¤å›¾åƒç”Ÿæˆè¯·æ±‚\n\n          éœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®:\n          JIMENG_API_TOKEN - å³æ¢¦APIä»¤ç‰Œï¼ˆä»å³æ¢¦ç½‘ç«™è·å–çš„sessionidï¼‰\n\n          å‚æ•°è¯´æ˜:\n          - filePath: æœ¬åœ°å›¾ç‰‡è·¯å¾„æˆ–å›¾ç‰‡URLï¼ˆå¯é€‰ï¼Œè‹¥å¡«å†™åˆ™ä¸ºå›¾ç‰‡æ··åˆ/å‚è€ƒå›¾ç”ŸæˆåŠŸèƒ½ï¼‰\n          - prompt: ç”Ÿæˆå›¾åƒçš„æ–‡æœ¬æè¿°ï¼ˆå¿…å¡«ï¼‰\n          - model: æ¨¡å‹åç§°ï¼Œå¯é€‰å€¼: jimeng-3.0, jimeng-2.1, jimeng-2.0-pro, jimeng-2.0, jimeng-1.4, jimeng-xl-proï¼ˆå¯é€‰ï¼‰\n          - width: å›¾åƒå®½åº¦ï¼Œé»˜è®¤å€¼ï¼š1024ï¼ˆå¯é€‰ï¼‰\n          - height: å›¾åƒé«˜åº¦ï¼Œé»˜è®¤å€¼ï¼š1024ï¼ˆå¯é€‰ï¼‰\n          - sample_strength: ç²¾ç»†åº¦ï¼Œé»˜è®¤å€¼ï¼š0.5ï¼ŒèŒƒå›´0-1ï¼ˆå¯é€‰ï¼‰\n          - negative_prompt: åå‘æç¤ºè¯ï¼Œå‘Šè¯‰æ¨¡å‹ä¸è¦ç”Ÿæˆä»€ä¹ˆå†…å®¹ï¼ˆå¯é€‰ï¼‰\n\n          ç¤ºä¾‹:\n          generateImage({\n            \"filePath\": \"./test.png\",\n            \"prompt\": \"ä¸€åªå¯çˆ±çš„çŒ«å’ª\",\n            \"model\": \"jimeng-2.1\",\n            \"width\": 1024,\n            \"height\": 1024,\n            \"sample_strength\": 0.7,\n            \"negative_prompt\": \"æ¨¡ç³Šï¼Œæ‰­æ›²ï¼Œä½è´¨é‡\"\n          })\n        `\n      }]\n    })\n  );\n\n  // æ·»åŠ å³æ¢¦AIè§†é¢‘ç”ŸæˆæœåŠ¡ä¿¡æ¯èµ„æº\n  server.resource(\n    \"jimeng-ai-video\",\n    \"jimeng-ai-video://info\",\n    async (uri) => ({\n      contents: [{\n        uri: uri.href,\n        text: `\n          å³æ¢¦AIè§†é¢‘ç”ŸæˆæœåŠ¡\n          -----------------\n          é€šè¿‡ä½¿ç”¨ generateVideo å·¥å…·æäº¤è§†é¢‘ç”Ÿæˆè¯·æ±‚\n          æ”¯æŒä¼ ç»Ÿé¦–å°¾å¸§æ¨¡å¼å’Œæ™ºèƒ½å¤šå¸§æ¨¡å¼\n\n          éœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®:\n          JIMENG_API_TOKEN - å³æ¢¦APIä»¤ç‰Œï¼ˆä»å³æ¢¦ç½‘ç«™è·å–çš„sessionidï¼‰\n\n          ğŸ¬ ä¼ ç»Ÿæ¨¡å¼å‚æ•°:\n          - filePath: é¦–å¸§å’Œå°¾å¸§å›¾ç‰‡è·¯å¾„ï¼Œæ”¯æŒæ•°ç»„ï¼Œæœ€å¤š2ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«ä¸ºé¦–å¸§å’Œå°¾å¸§ï¼ˆå¯é€‰ï¼‰\n          - prompt: ç”Ÿæˆè§†é¢‘çš„æ–‡æœ¬æè¿°ï¼ˆå¿…å¡«ï¼‰\n          - model: æ¨¡å‹åç§°ï¼Œé»˜è®¤jimeng-video-3.0ï¼ˆå¯é€‰ï¼‰\n\n          ğŸ­ æ™ºèƒ½å¤šå¸§æ¨¡å¼å‚æ•°:\n          - multiFrames: æ™ºèƒ½å¤šå¸§é…ç½®ï¼Œæ”¯æŒå¤šä¸ªå…³é”®å¸§ï¼ˆæ•°ç»„ï¼Œæœ€å¤š10å¸§ï¼‰\n            - idx: å¸§ç´¢å¼•\n            - duration_ms: å¸§æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼ŒèŒƒå›´ï¼š1000-5000msï¼Œå³1-5ç§’ï¼‰\n            - prompt: è¯¥å¸§çš„æç¤ºè¯\n            - image_path: è¯¥å¸§çš„å›¾ç‰‡è·¯å¾„\n          - model: æ¨¡å‹åç§°ï¼Œé»˜è®¤jimeng-video-multiframeï¼ˆå¯é€‰ï¼‰\n          - fps: å¸§ç‡ï¼Œé»˜è®¤24ï¼ˆå¯é€‰ï¼‰\n          - duration_ms: æ€»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼Œå¯é€‰ï¼‰\n          - video_aspect_ratio: è§†é¢‘æ¯”ä¾‹ï¼Œå¦‚\"3:4\"ï¼ˆå¯é€‰ï¼‰\n\n          ğŸ”§ é€šç”¨å‚æ•°:\n          - resolution: åˆ†è¾¨ç‡ï¼Œå¯é€‰720pæˆ–1080pï¼Œé»˜è®¤720pï¼ˆå¯é€‰ï¼‰\n          - width: è§†é¢‘å®½åº¦ï¼Œé»˜è®¤1024ï¼ˆå¯é€‰ï¼‰\n          - height: è§†é¢‘é«˜åº¦ï¼Œé»˜è®¤1024ï¼ˆå¯é€‰ï¼‰\n          - refresh_token: å³æ¢¦APIä»¤ç‰Œï¼ˆå¯é€‰ï¼Œé€šå¸¸ä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰\n          - req_key: è‡ªå®šä¹‰å‚æ•°ï¼Œå…¼å®¹æ—§æ¥å£ï¼ˆå¯é€‰ï¼‰\n\n          ğŸ“ ä¼ ç»Ÿæ¨¡å¼ç¤ºä¾‹:\n          generateVideo({\n            \"filePath\": [\"./first.png\", \"./last.png\"],\n            \"prompt\": \"ä¸€åªå°ç‹—åœ¨è‰åœ°ä¸Šå¥”è·‘ï¼Œé˜³å…‰æ˜åªšï¼Œé«˜æ¸…\",\n            \"model\": \"jimeng-video-3.0\",\n            \"resolution\": \"720p\"\n          })\n\n          ğŸ“ æ™ºèƒ½å¤šå¸§æ¨¡å¼ç¤ºä¾‹:\n          generateVideo({\n            \"multiFrames\": [\n              {\n                \"idx\": 0,\n                \"duration_ms\": 3000,\n                \"prompt\": \"å‰æ¨\",\n                \"image_path\": \"./frame1.png\"\n              },\n              {\n                \"idx\": 1,\n                \"duration_ms\": 2000,\n                \"prompt\": \"åæ¨\",\n                \"image_path\": \"./frame2.png\"\n              }\n            ],\n            \"prompt\": \"åœºæ™¯åˆ‡æ¢åŠ¨ç”»\",\n            \"model\": \"jimeng-video-multiframe\",\n            \"duration_ms\": 5000,\n            \"video_aspect_ratio\": \"3:4\"\n          })\n        `\n      }]\n    })\n  );\n\n  return server;\n};\n\n// å¯åŠ¨æœåŠ¡å™¨\nexport const startServer = async (): Promise<ServerInstance> => {\n  const server = createServer();\n  const transport = new StdioServerTransport();\n\n  console.log(\"Jimeng MCP Server æ­£åœ¨å¯åŠ¨...\");\n\n  await server.connect(transport);\n\n  console.log(\"Jimeng MCP Server å·²å¯åŠ¨\");\n\n  return { server, transport };\n}; ","import axios from 'axios';\nimport * as crypto from 'crypto';\nimport path from 'path';\nimport fs from 'fs';\n// @ts-ignore\nimport crc32 from 'crc32';\nimport { generate_a_bogus } from './utils/a_bogus.js';\nimport { generateMsToken, toUrlParams, generateUuid, jsonEncode, urlEncode, unixTimestamp } from './utils/index.js';\n\n\n// æ¨¡å‹æ˜ å°„\n// jimeng-4.0 (seedream4.0) çš„å†…éƒ¨æ¨¡å‹åç§°å·²é€šè¿‡ç½‘ç»œè¯·æ±‚åˆ†æç¡®è®¤\nconst MODEL_MAP: Record<string, string> = {\n  'jimeng-4.0': 'high_aes_general_v40', // ä»å®é™…ç½‘ç»œè¯·æ±‚ä¸­è·å–çš„æ­£ç¡®æ¨¡å‹åç§°\n  'jimeng-3.1': 'high_aes_general_v30l_art_fangzhou:general_v3.0_18b',\n  'jimeng-3.0': 'high_aes_general_v30l:general_v3.0_18b',\n  'jimeng-2.1': 'high_aes_general_v21_L:general_v2.1_L',\n  'jimeng-2.0-pro': 'high_aes_general_v20_L:general_v2.0_L',\n  'jimeng-2.0': 'high_aes_general_v20:general_v2.0',\n  'jimeng-1.4': 'high_aes_general_v14:general_v1.4',\n  'jimeng-xl-pro': 'text2img_xl_sft',\n  // video\n  'jimeng-video-3.0-pro': 'dreamina_ic_generate_video_model_vgfm_3.0_pro',\n  'jimeng-video-3.0': 'dreamina_ic_generate_video_model_vgfm_3.0',\n  'jimeng-video-2.0': 'dreamina_ic_generate_video_model_vgfm_lite',\n  'jimeng-video-2.0-pro': 'dreamina_ic_generate_video_model_vgfm1.0',\n  // multi-frame video\n  'jimeng-video-multiframe': 'dreamina_ic_generate_video_model_vgfm_3.0'\n};\n\n\n// å¸¸é‡å®šä¹‰\nconst DEFAULT_MODEL = 'jimeng-4.0';\nconst DEFAULT_VIDEO_MODEL = 'jimeng-video-3.0';\nconst DEFAULT_BLEND_MODEL = 'jimeng-3.0';\nconst DRAFT_VERSION = '3.0.2';\nconst DEFAULT_ASSISTANT_ID = '513695'; // ä»åŸå§‹ä»“åº“ä¸­æå–\nconst WEB_ID = Math.random() * 999999999999999999 + 7000000000000000000;\nconst USER_ID = generateUuid().replace(/-/g, '');\nconst UA = \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36\";\n\n// å®½é«˜æ¯”é¢„è®¾é€‰é¡¹\nexport interface AspectRatioPreset {\n  name: string;\n  ratio: number;\n  displayName: string;\n  imageRatio: number; // å³æ¢¦APIå†…éƒ¨çš„æ¯”ä¾‹æ ‡è¯†ç¬¦\n}\n\nexport const ASPECT_RATIO_PRESETS: AspectRatioPreset[] = [\n  { name: 'auto', ratio: 0, displayName: 'æ™ºèƒ½', imageRatio: 1 },\n  { name: '21:9', ratio: 21/9, displayName: '21:9', imageRatio: 8 },\n  { name: '16:9', ratio: 16/9, displayName: '16:9', imageRatio: 3 },\n  { name: '3:2', ratio: 3/2, displayName: '3:2', imageRatio: 7 },\n  { name: '4:3', ratio: 4/3, displayName: '4:3', imageRatio: 4 },\n  { name: '1:1', ratio: 1, displayName: '1:1', imageRatio: 1 },\n  { name: '3:4', ratio: 3/4, displayName: '3:4', imageRatio: 2 },\n  { name: '2:3', ratio: 2/3, displayName: '2:3', imageRatio: 6 },\n  { name: '9:16', ratio: 9/16, displayName: '9:16', imageRatio: 5 }\n];\n// å›¾åƒå°ºå¯¸è®¡ç®—å·¥å…·\nexport class ImageDimensionCalculator {\n  // æ ‡å‡†å°ºå¯¸æ˜ å°„è¡¨ï¼ˆåŸºäºç”¨æˆ·æä¾›çš„ç²¾ç¡®è§„æ ¼ï¼‰\n  private static readonly STANDARD_DIMENSIONS: Record<string, { width: number; height: number }> = {\n    '21:9': { width: 3024, height: 1296 },\n    '16:9': { width: 2560, height: 1440 },\n    '3:2': { width: 2496, height: 1664 },\n    '4:3': { width: 2304, height: 1728 },\n    '1:1': { width: 2048, height: 2048 },\n    '3:4': { width: 1728, height: 2304 },\n    '2:3': { width: 1664, height: 2496 },\n    '9:16': { width: 1440, height: 2560 }\n  };\n\n  static calculateDimensions(aspectRatio: string = 'auto'): { width: number; height: number; imageRatio: number } {\n    // è·å–é¢„è®¾é…ç½®\n    const preset = ASPECT_RATIO_PRESETS.find(p => p.name === aspectRatio);\n    if (!preset) {\n      throw new Error(`ä¸æ”¯æŒçš„å®½é«˜æ¯”: ${aspectRatio}. æ”¯æŒçš„å€¼: ${ASPECT_RATIO_PRESETS.map(p => p.name).join(', ')}`);\n    }\n\n    // æ™ºèƒ½æ¨¡å¼ç‰¹æ®Šå¤„ç†\n    if (preset.name === 'auto') {\n      return { width: 1024, height: 1024, imageRatio: preset.imageRatio };\n    }\n\n    // ç›´æ¥ä½¿ç”¨å›ºå®šè¡¨æ ¼ï¼Œä¸åšä»»ä½•è®¡ç®—æˆ–é™åˆ¶\n    const dimensions = this.STANDARD_DIMENSIONS[preset.name];\n    if (!dimensions) {\n      throw new Error(`æœªæ‰¾åˆ° ${aspectRatio} çš„å°ºå¯¸é…ç½®`);\n    }\n\n    return {\n      width: dimensions.width,\n      height: dimensions.height,\n      imageRatio: preset.imageRatio\n    };\n  }\n\n  static getPresetByName(name: string): AspectRatioPreset | undefined {\n    return ASPECT_RATIO_PRESETS.find(p => p.name === name);\n  }\n\n  static getAllPresets(): AspectRatioPreset[] {\n    return ASPECT_RATIO_PRESETS;\n  }\n\n  static getStandardDimensions(): Record<string, { width: number; height: number }> {\n    return this.STANDARD_DIMENSIONS;\n  }\n}\n\n// åˆ†è¾¨ç‡ç±»å‹åˆ¤æ–­å·¥å…·\nfunction getResolutionType(width: number, height: number): string {\n  const maxDimension = Math.max(width, height);\n  if (maxDimension <= 1024) {\n    return '1k';\n  } else if (maxDimension <= 1536) {\n    return '1.5k';\n  } else if (maxDimension <= 2048) {\n    return '2k';\n  } else if (maxDimension <= 2560) {\n    return '2.5k';\n  } else {\n    return '3k';\n  }\n}\n\n// æ¥å£å®šä¹‰\ninterface LogoInfo {\n  add_logo?: boolean; // æ˜¯å¦æ·»åŠ æ°´å° é»˜è®¤ä¸æ·»åŠ \n  position?: number; // 0-å³ä¸‹è§’ 1-å·¦ä¸‹è§’ 2-å·¦ä¸Šè§’ 3-å³ä¸Šè§’\n  language?: number; // 0-ä¸­æ–‡ï¼ˆAIç”Ÿæˆï¼‰1-è‹±æ–‡ï¼ˆGenerated by AIï¼‰\n  opacity?: number; // 0-1 default: 0.3\n  logo_text_content?: string; // æ°´å°æ–‡å­—å†…å®¹\n}\n\ninterface ImageGenerationParams {\n  filePath?: string; // å›¾ç‰‡è·¯å¾„\n  model?: string; // æ¨¡å‹åç§°ï¼Œé»˜è®¤ä½¿ç”¨ DEFAULT_MODEL\n  prompt: string; // æç¤ºè¯\n  aspectRatio?: string; // å®½é«˜æ¯”é¢„è®¾ï¼Œå¦‚ '16:9', '9:16', 'auto' ç­‰\n  sample_strength?: number; // ç²¾ç»†åº¦ï¼Œé»˜è®¤0.5\n  negative_prompt?: string; // åå‘æç¤ºè¯ï¼Œé»˜è®¤ç©º\n  refresh_token?: string; // åˆ·æ–°ä»¤ç‰Œï¼Œå¿…éœ€\n  req_key?: string; // è‡ªå®šä¹‰å‚æ•°ï¼Œå…¼å®¹æ—§æ¥å£\n}\n\ninterface MultiFrameConfig {\n  idx: number; // å¸§ç´¢å¼•\n  duration_ms: number; // å¸§æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼ŒèŒƒå›´ï¼š1000-5000msï¼Œå³1-5ç§’ï¼‰\n  prompt: string; // è¯¥å¸§çš„æç¤ºè¯\n  image_path: string; // è¯¥å¸§çš„å›¾ç‰‡è·¯å¾„\n}\n\ninterface VideoGenerationParams {\n  filePath?: string[]; // é¦–å¸§å’Œå°¾å¸§è·¯å¾„ï¼Œæ”¯æŒæ•°ç»„ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰\n  multiFrames?: MultiFrameConfig[]; // æ™ºèƒ½å¤šå¸§é…ç½®ï¼ˆæ–°æ¨¡å¼ï¼Œæœ€å¤š10å¸§ï¼‰\n  resolution?: string; // åˆ†è¾¨ç‡ 720p 1080p\n  model?: string; // æ¨¡å‹åç§°ï¼Œé»˜è®¤ä½¿ç”¨ DEFAULT_MODEL\n  prompt: string; // æç¤ºè¯ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰æˆ–å…¨å±€æç¤ºè¯ï¼ˆå¤šå¸§æ¨¡å¼ï¼‰\n  width?: number; // å›¾åƒå®½åº¦ï¼Œé»˜è®¤1024\n  height?: number; // å›¾åƒé«˜åº¦ï¼Œé»˜è®¤1024\n  fps?: number; // å¸§ç‡ï¼Œé»˜è®¤24ï¼ˆå¤šå¸§æ¨¡å¼ï¼‰\n  duration_ms?: number; // æ€»æ—¶é•¿ï¼ˆæ¯«ç§’ï¼Œå¤šå¸§æ¨¡å¼ï¼‰\n  video_aspect_ratio?: string; // è§†é¢‘æ¯”ä¾‹ï¼Œå¦‚\"3:4\"ï¼ˆå¤šå¸§æ¨¡å¼ï¼‰\n  refresh_token?: string; // åˆ·æ–°ä»¤ç‰Œï¼Œå¿…éœ€\n  req_key?: string; // è‡ªå®šä¹‰å‚æ•°ï¼Œå…¼å®¹æ—§æ¥å£\n}\n\nexport function generateCookie(refreshToken: string) {\n  return [\n    `_tea_web_id=${WEB_ID}`,\n    `is_staff_user=false`,\n    `store-region=cn-gd`,\n    `store-region-src=uid`,\n    `sid_guard=${refreshToken}%7C${unixTimestamp()}%7C5184000%7CMon%2C+03-Feb-2025+08%3A17%3A09+GMT`,\n    `uid_tt=${USER_ID}`,\n    `uid_tt_ss=${USER_ID}`,\n    `sid_tt=${refreshToken}`,\n    `sessionid=${refreshToken}`,\n    `sessionid_ss=${refreshToken}`,\n    `sid_tt=${refreshToken}`\n  ].join(\"; \");\n}\n\n// å³æ¢¦APIå®¢æˆ·ç«¯ç±»\nclass JimengApiClient {\n  private refreshToken: string;\n  private getUploadImageProofUrl = 'https://imagex.bytedanceapi.com/'\n\n  constructor(token?: string) {\n    this.refreshToken = token || process.env.JIMENG_API_TOKEN || '';\n    if (!this.refreshToken) {\n      throw new Error('JIMENG_API_TOKEN ç¯å¢ƒå˜é‡æœªè®¾ç½®');\n    }\n  }\n\n  /**\n   * è·å–æ¨¡å‹æ˜ å°„\n   * @param model æ¨¡å‹åç§°\n   * @returns æ˜ å°„åçš„æ¨¡å‹åç§°\n   */\n  private getModel(model: string): string {\n    const mappedModel = MODEL_MAP[model] || MODEL_MAP[DEFAULT_MODEL];\n    console.log(`ğŸ” æ¨¡å‹æ˜ å°„è°ƒè¯•: ${model} -> ${mappedModel} (æ›´æ–°æ—¶é—´: ${new Date().toISOString()})`);\n    return mappedModel;\n  }\n\n  /**\n   * å‘é€è¯·æ±‚åˆ°å³æ¢¦API\n   * @param method è¯·æ±‚æ–¹æ³•\n   * @param path è¯·æ±‚è·¯å¾„\n   * @param data è¯·æ±‚æ•°æ®\n   * @param params è¯·æ±‚å‚æ•°\n   * @param headers è¯·æ±‚å¤´\n   * @returns å“åº”ç»“æœ\n   */\n  private async request(\n    method: string,\n    path: string,\n    data: any = {},\n    params: any = {},\n    headers: any = {}\n  ): Promise<any> {\n    const baseUrl = 'https://jimeng.jianying.com';\n    const url = path.includes('https://') ? path : `${baseUrl}${path}`;\n    const FAKE_HEADERS = {\n      Accept: \"application/json, text/plain, */*\",\n      \"Accept-Encoding\": \"gzip, deflate, br, zstd\",\n      \"Accept-language\": \"zh-CN,zh;q=0.9\",\n      \"Cache-control\": \"no-cache\",\n      \"Last-event-id\": \"undefined\",\n      Appid: DEFAULT_ASSISTANT_ID,\n      Appvr: \"5.8.0\",\n      Origin: \"https://jimeng.jianying.com\",\n      Pragma: \"no-cache\",\n      Priority: \"u=1, i\",\n      Referer: \"https://jimeng.jianying.com\",\n      Pf: \"7\",\n      \"Sec-Ch-Ua\":\n        '\"Google Chrome\";v=\"131\", \"Chromium\";v=\"131\", \"Not_A Brand\";v=\"24\"',\n      \"Sec-Ch-Ua-Mobile\": \"?0\",\n      \"Sec-Ch-Ua-Platform\": '\"Windows\"',\n      \"Sec-Fetch-Dest\": \"empty\",\n      \"Sec-Fetch-Mode\": \"cors\",\n      \"Sec-Fetch-Site\": \"same-origin\",\n      \"User-Agent\": UA\n    };\n    const requestHeaders = {\n      ...FAKE_HEADERS,\n      'Cookie': generateCookie(this.refreshToken),\n      ...headers\n    };\n    try {\n      const response = await axios({\n        method: method.toLowerCase(),\n        url,\n        data: method.toUpperCase() !== 'GET' ? data : undefined,\n        params: method.toUpperCase() === 'GET' ? { ...data, ...params } : params,\n        headers: requestHeaders,\n        timeout: 60000\n      });\n\n\n      return response.data;\n    } catch (error) {\n      if (axios.isAxiosError(error) && error.response) {\n        throw new Error(`å³æ¢¦APIè¯·æ±‚é”™è¯¯: ${JSON.stringify(error.response.data)}`);\n      } else {\n        throw new Error(`å³æ¢¦APIè¯·æ±‚å¤±è´¥: ${error}`);\n      }\n    }\n  }\n\n  /**\n   * è·å–ç§¯åˆ†ä¿¡æ¯\n   * @returns ç§¯åˆ†ä¿¡æ¯\n   */\n  public async getCredit(): Promise<Record<string, number>> {\n    const result = await this.request(\n      'POST',\n      '/commerce/v1/benefits/user_credit',\n      {},\n      {},\n      { 'Referer': 'https://jimeng.jianying.com/ai-tool/image/generate' }\n    );\n\n    const credit = result.credit || {};\n    const giftCredit = credit.gift_credit || 0;\n    const purchaseCredit = credit.purchase_credit || 0;\n    const vipCredit = credit.vip_credit || 0;\n\n    return {\n      giftCredit,\n      purchaseCredit,\n      vipCredit,\n      totalCredit: giftCredit + purchaseCredit + vipCredit\n    };\n  }\n\n  /**\n   * é¢†å–ç§¯åˆ†\n   */\n  public async receiveCredit(): Promise<void> {\n    const credit = await this.request(\n      'POST',\n      '/commerce/v1/benefits/credit_receive',\n      { 'time_zone': 'Asia/Shanghai' },\n      {},\n      { 'Referer': 'https://jimeng.jianying.com/ai-tool/image/generate' }\n    );\n    console.log(\"é¢†å–ç§¯åˆ†\", credit)\n  }\n\n  /**\n   * å³æ¢¦AIå›¾åƒç”Ÿæˆï¼ˆæ”¯æŒæ‰¹é‡ç”Ÿæˆï¼‰\n   * @param params å›¾åƒç”Ÿæˆå‚æ•°\n   * @returns ç”Ÿæˆçš„å›¾åƒURLåˆ—è¡¨\n   */\n  public async generateImage(params: ImageGenerationParams): Promise<string[]> {\n    // ğŸ” Debug logging - è®°å½•APIç±»æ–¹æ³•è°ƒç”¨\n    console.log('ğŸ” [API Client] generateImage method called');\n    console.log('ğŸ” [API Client] Token in this instance:', this.refreshToken ? '[PROVIDED]' : '[MISSING]');\n    console.log('ğŸ” [API Client] Parameters received:', JSON.stringify({\n      filePath: params.filePath,\n      prompt: params.prompt ? `${params.prompt.substring(0, 50)}...` : undefined,\n      model: params.model,\n      aspectRatio: params.aspectRatio,\n      sample_strength: params.sample_strength,\n      negative_prompt: params.negative_prompt\n    }, null, 2));\n    \n    return await this.generateImageWithBatch(params);\n  }\n\n  /**\n   * æ‰¹é‡ç”Ÿæˆå›¾åƒï¼Œæ”¯æŒè‡ªåŠ¨ç»§ç»­ç”Ÿæˆ\n   * @param params å›¾åƒç”Ÿæˆå‚æ•°\n   * @returns ç”Ÿæˆçš„å›¾åƒURLåˆ—è¡¨\n   */\n  private async generateImageWithBatch(params: ImageGenerationParams): Promise<string[]> {\n    // ğŸ” Debug logging - è®°å½•æ‰¹é‡ç”Ÿæˆæ–¹æ³•å…¥å£\n    console.log('ğŸ” [API Client] generateImageWithBatch called');\n    console.log('ğŸ” [API Client] Full params object:', JSON.stringify(params, null, 2));\n    \n    // å‚æ•°éªŒè¯\n    console.log('ğŸ” [API Client] Validating parameters...');\n    if (!params.prompt || typeof params.prompt !== 'string') {\n      console.error('ğŸ” [API Client] Parameter validation failed: prompt is invalid');\n      console.error('ğŸ” [API Client] prompt value:', params.prompt);\n      console.error('ğŸ” [API Client] prompt type:', typeof params.prompt);\n      throw new Error('promptå¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²');\n    }\n    console.log('ğŸ” [API Client] Parameter validation passed');\n    \n    const hasFilePath = Boolean(params?.filePath)\n    let uploadID = null\n    if (params?.filePath) {\n      uploadID = await this.uploadCoverFile(params.filePath)\n    }\n    \n    // è·å–å®é™…æ¨¡å‹\n    const modelName = hasFilePath ? DEFAULT_BLEND_MODEL : params.model || DEFAULT_MODEL;\n    const actualModel = this.getModel(modelName);\n    \n    // æ£€æŸ¥ç§¯åˆ†\n    const creditInfo = await this.getCredit();\n    if (creditInfo.totalCredit <= 0) {\n      await this.receiveCredit();\n    }\n\n    // ç¬¬ä¸€æ¬¡ç”Ÿæˆ\n    console.log('ğŸ” å¼€å§‹ç¬¬ä¸€æ¬¡å›¾åƒç”Ÿæˆè¯·æ±‚...');\n    const firstResult = await this.performSingleGeneration(params, actualModel, modelName, hasFilePath, uploadID);\n    let allResults: string[] = [...firstResult.imageUrls];\n    const historyId = firstResult.historyId;\n    let recordData = firstResult.recordData;\n    \n    if (!historyId) {\n      throw new Error('æœªèƒ½è·å–å†å²è®°å½•ID');\n    }\n\n    console.log(`ğŸ” ç¬¬ä¸€æ¬¡ç”Ÿæˆå®Œæˆï¼Œè·å¾— ${firstResult.imageUrls.length} å¼ å›¾ç‰‡`);\n\n    // æ£€æŸ¥è½®è¯¢è¿‡ç¨‹ä¸­æ˜¯å¦æ£€æµ‹åˆ°éœ€è¦ç»§ç»­ç”Ÿæˆ\n    if (firstResult.needsContinuation) {\n      console.log('ğŸ” è½®è¯¢è¿‡ç¨‹ä¸­æ£€æµ‹åˆ°éœ€è¦ç»§ç»­ç”Ÿæˆï¼Œç«‹å³å‘é€ç»§ç»­ç”Ÿæˆè¯·æ±‚');\n      try {\n        const continuationResult = await this.performContinuationGeneration(\n          params, \n          actualModel, \n          modelName, \n          hasFilePath, \n          uploadID, \n          historyId, \n          allResults.length\n        );\n        \n        allResults.push(...continuationResult.imageUrls);\n        recordData = continuationResult.recordData;\n        \n        console.log(`ğŸ” ç»§ç»­ç”Ÿæˆå®Œæˆï¼Œæ–°å¢ ${continuationResult.imageUrls.length} å¼ å›¾ç‰‡ï¼Œæ€»è®¡ ${allResults.length} å¼ `);\n      } catch (error) {\n        console.error(`ğŸ” ç»§ç»­ç”Ÿæˆå¤±è´¥:`, error);\n      }\n    }\n\n    // æ£€æŸ¥æ˜¯å¦è¿˜éœ€è¦ç»§ç»­ç”Ÿæˆï¼ˆç”¨äºè¶…è¿‡8å¼ å›¾ç‰‡çš„æƒ…å†µï¼‰\n    let continuationCount = 0;\n    const maxContinuations = 10; // æœ€å¤šç»§ç»­ç”Ÿæˆ10æ¬¡ï¼Œé¿å…æ— é™å¾ªç¯\n    \n    while (continuationCount < maxContinuations && this.shouldContinueGeneration(recordData, allResults.length)) {\n      continuationCount++;\n      console.log(`ğŸ” å¼€å§‹ç¬¬${continuationCount + 1}æ¬¡ç»§ç»­ç”Ÿæˆè¯·æ±‚...`);\n      \n      try {\n        const continuationResult = await this.performContinuationGeneration(\n          params, \n          actualModel, \n          modelName, \n          hasFilePath, \n          uploadID, \n          historyId, \n          allResults.length\n        );\n        \n        allResults.push(...continuationResult.imageUrls);\n        recordData = continuationResult.recordData;\n        \n        console.log(`ğŸ” ç¬¬${continuationCount + 1}æ¬¡ç»§ç»­ç”Ÿæˆå®Œæˆï¼Œæ–°å¢ ${continuationResult.imageUrls.length} å¼ å›¾ç‰‡ï¼Œæ€»è®¡ ${allResults.length} å¼ `);\n      } catch (error) {\n        console.error(`ğŸ” ç¬¬${continuationCount + 1}æ¬¡ç»§ç»­ç”Ÿæˆå¤±è´¥:`, error);\n        break;\n      }\n    }\n\n    console.log(`ğŸ” æ‰¹é‡ç”Ÿæˆå®Œæˆï¼Œæ€»å…±ç”Ÿæˆäº† ${allResults.length} å¼ å›¾ç‰‡`);\n    \n    // å»é‡å¤„ç†\n    const deduplicatedResults = this.deduplicateImageUrls(allResults);\n    if (deduplicatedResults.length !== allResults.length) {\n      console.log(`âš ï¸ æ£€æµ‹åˆ°é‡å¤å›¾ç‰‡ï¼Œå·²å»é‡: ${allResults.length} -> ${deduplicatedResults.length}`);\n    }\n    \n    return deduplicatedResults;\n  }\n\n  /**\n   * æ‰§è¡Œå•æ¬¡ç”Ÿæˆï¼ˆç¬¬ä¸€æ¬¡è¯·æ±‚ï¼‰\n   */\n  private async performSingleGeneration(\n    params: ImageGenerationParams, \n    actualModel: string, \n    modelName: string, \n    hasFilePath: boolean, \n    uploadID: string | null\n  ): Promise<{ imageUrls: string[], historyId: string | null, recordData: any, needsContinuation: boolean }> {\n    // ä½¿ç”¨ç»Ÿä¸€æ–¹æ³•æ„å»ºè¯·æ±‚æ•°æ®\n    const { rqData, rqParams } = this.buildGenerationRequestData(\n      params, actualModel, modelName, hasFilePath, uploadID\n    );\n\n    // è®°å½•å®Œæ•´çš„æäº¤è¯·æ±‚å†…å®¹\n    console.log('ğŸ” å›¾åƒç”Ÿæˆè¯·æ±‚å‚æ•°:', JSON.stringify({ \n      requestedModel: modelName,\n      actualModel,\n      rqData: {\n        extend: rqData.extend,\n        draft_content_sample: rqData.draft_content.substring(0, 200) + '...'\n      }\n    }, null, 2));\n\n    // å‘é€ç”Ÿæˆè¯·æ±‚\n    const result = await this.request(\n      'POST',\n      '/mweb/v1/aigc_draft/generate',\n      rqData,\n      rqParams\n    );\n\n    // ç¬¬ä¸€æ¬¡ç”Ÿæˆä¸éœ€è¦å¢é‡ï¼Œä¼ å…¥0ä½œä¸ºlastItemCount\n    const pollResult = await this.pollResultWithHistoryExtended(result, 0);\n    const itemList = pollResult.itemList;\n    const recordData = pollResult.recordData;\n    const needsContinuation = pollResult.needsContinuation;\n    \n    // ä¿å­˜å®Œæ•´çš„è¿”å›æ•°æ®åˆ°æ–‡ä»¶ä¸­ä»¥ä¾›åˆ†æ\n    const debugData = {\n      timestamp: new Date().toISOString(),\n      requestedModel: modelName,\n      actualModel,\n      pollResult: itemList,\n      originalResult: result,\n      recordData: recordData\n    };\n    \n    const fs = await import('fs');\n    const debugFileName = `debug-jimeng-response-${modelName}-${Date.now()}.json`;\n    fs.writeFileSync(debugFileName, JSON.stringify(debugData, null, 2));\n    console.log('ğŸ” å®Œæ•´è¿”å›æ•°æ®å·²ä¿å­˜åˆ°:', debugFileName);\n\n    // æå–å›¾ç‰‡URL\n    const imageUrls = this.extractImageUrls(itemList);\n    \n    return {\n      imageUrls,\n      historyId: result?.data?.aigc_data?.history_record_id || null,\n      recordData,\n      needsContinuation\n    };\n  }\n\n  /**\n   * æ‰§è¡Œç»§ç»­ç”Ÿæˆè¯·æ±‚\n   */\n  private async performContinuationGeneration(\n    params: ImageGenerationParams, \n    actualModel: string, \n    modelName: string, \n    hasFilePath: boolean, \n    uploadID: string | null,\n    historyId: string,\n    currentItemCount: number = 0\n  ): Promise<{ imageUrls: string[], recordData: any }> {\n    // ä½¿ç”¨ç»Ÿä¸€æ–¹æ³•æ„å»ºç»§ç»­ç”Ÿæˆè¯·æ±‚æ•°æ®\n    const { rqData, rqParams } = this.buildGenerationRequestData(\n      params, actualModel, modelName, hasFilePath, uploadID, historyId, true\n    );\n\n    console.log('ğŸ” ç»§ç»­ç”Ÿæˆè¯·æ±‚å‚æ•°:', JSON.stringify({ \n      action: rqData.action,\n      history_id: rqData.history_id,\n      requestedModel: modelName,\n      actualModel\n    }, null, 2));\n\n    // å‘é€ç»§ç»­ç”Ÿæˆè¯·æ±‚\n    const result = await this.request(\n      'POST',\n      '/mweb/v1/aigc_draft/generate',\n      rqData,\n      rqParams\n    );\n\n    // ç»§ç»­ç”Ÿæˆæ—¶ä¼ å…¥å½“å‰å·²æœ‰çš„é¡¹ç›®æ•°é‡ï¼Œå®ç°å¢é‡è¿”å›\n    const pollResult = await this.pollResultWithHistoryExtended(result, currentItemCount);\n    const itemList = pollResult.itemList;\n    const recordData = pollResult.recordData;\n\n    // æå–å›¾ç‰‡URL\n    const imageUrls = this.extractImageUrls(itemList);\n    \n    return {\n      imageUrls,\n      recordData\n    };\n  }\n\n  /**\n   * åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­ç”Ÿæˆ\n   */\n  private shouldContinueGeneration(recordData: any, currentCount: number): boolean {\n    if (!recordData) {\n      console.log('ğŸ” æ— recordDataï¼Œåœæ­¢ç»§ç»­ç”Ÿæˆ');\n      return false;\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦æœ‰æœªå®Œæˆçš„å›¾ç‰‡æ•°é‡æŒ‡ç¤º\n    const finishedCount = recordData.finished_image_count || 0;\n    const totalCount = recordData.total_image_count || 0;\n    const taskStatus = recordData.status;\n    const confirmStatus = recordData.confirm_status;\n    \n    console.log(`ğŸ” ç”ŸæˆçŠ¶æ€æ£€æŸ¥: finished_image_count=${finishedCount}, total_image_count=${totalCount}, currentCount=${currentCount}, status=${taskStatus}, confirm_status=${confirmStatus}`);\n    \n    // å¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ç»§ç»­\n    if (taskStatus === 30) {\n      console.log('ğŸ” ä»»åŠ¡çŠ¶æ€ä¸º30ï¼ˆå¤±è´¥ï¼‰ï¼Œåœæ­¢ç»§ç»­ç”Ÿæˆ');\n      return false;\n    }\n    \n    // ä¿®å¤çš„ä¸»è¦åˆ¤æ–­æ¡ä»¶ï¼šåªæœ‰å½“totalCountå¤§äº4ä¸”å½“å‰æ•°é‡å°äºæ€»æ•°æ—¶æ‰ç»§ç»­ç”Ÿæˆ\n    // è¿™é¿å…äº†åœ¨è·å¾—æ ‡å‡†4å¼ å›¾ç‰‡æ—¶è¿›è¡Œä¸å¿…è¦çš„ç»§ç»­ç”Ÿæˆè¯·æ±‚\n    if (totalCount > 4 && currentCount < totalCount) {\n      console.log(`ğŸ” éœ€è¦ç»§ç»­ç”Ÿæˆ: ç›®æ ‡${totalCount}å¼ (>4å¼ )ï¼Œå·²è·å¾—${currentCount}å¼ `);\n      return true;\n    }\n    \n    // å¦‚æœtotalCount <= 4ï¼Œè¯´æ˜æ˜¯æ ‡å‡†ç”Ÿæˆï¼Œä¸éœ€è¦ç»§ç»­\n    if (totalCount <= 4) {\n      console.log(`ğŸ” æ ‡å‡†ç”Ÿæˆå®Œæˆ: æ€»æ•°${totalCount}å¼ (<=4å¼ )ï¼Œå·²è·å¾—${currentCount}å¼ ï¼Œæ— éœ€ç»§ç»­ç”Ÿæˆ`);\n      return false;\n    }\n    \n    console.log('ğŸ” æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåœæ­¢ç»§ç»­ç”Ÿæˆ');\n    return false;\n  }\n\n\n  /**\n   * æ„å»ºé€šç”¨çš„ç”Ÿæˆè¯·æ±‚æ•°æ®\n   * @param params å›¾åƒç”Ÿæˆå‚æ•°\n   * @param actualModel å®é™…æ¨¡å‹åç§°\n   * @param modelName è¯·æ±‚çš„æ¨¡å‹åç§°\n   * @param hasFilePath æ˜¯å¦æœ‰æ–‡ä»¶è·¯å¾„\n   * @param uploadID ä¸Šä¼ æ–‡ä»¶ID\n   * @param historyId å†å²è®°å½•IDï¼ˆç»§ç»­ç”Ÿæˆæ—¶ä½¿ç”¨ï¼‰\n   * @param isContinuation æ˜¯å¦æ˜¯ç»§ç»­ç”Ÿæˆè¯·æ±‚\n   */\n  private buildGenerationRequestData(\n    params: ImageGenerationParams,\n    actualModel: string,\n    modelName: string,\n    hasFilePath: boolean,\n    uploadID: string | null,\n    historyId?: string,\n    isContinuation: boolean = false\n  ): { rqData: any, rqParams: any } {\n    // ç”Ÿæˆç»„ä»¶ID\n    const componentId = generateUuid();\n    \n    // è®¡ç®—åŸºäºå®½é«˜æ¯”çš„å°ºå¯¸\n    console.log('ğŸ” [API Client] Calculating dimensions for aspectRatio:', params.aspectRatio || 'auto');\n    \n    try {\n      const dimensions = ImageDimensionCalculator.calculateDimensions(params.aspectRatio || 'auto');\n      const { width, height, imageRatio } = dimensions;\n      \n      console.log(`ğŸ” [API Client] Dimension calculation successful:`);\n      console.log(`ğŸ” [API Client] - Input aspectRatio: ${params.aspectRatio || 'auto'}`);\n      console.log(`ğŸ” [API Client] - Calculated width: ${width}`);\n      console.log(`ğŸ” [API Client] - Calculated height: ${height}`);\n      console.log(`ğŸ” [API Client] - Calculated imageRatio: ${imageRatio}`);\n    } catch (dimensionError) {\n      console.error('ğŸ” [API Client] Dimension calculation failed:');\n      console.error('ğŸ” [API Client] Error:', dimensionError);\n      console.error('ğŸ” [API Client] aspectRatio value:', params.aspectRatio);\n      throw dimensionError;\n    }\n    \n    const dimensions = ImageDimensionCalculator.calculateDimensions(params.aspectRatio || 'auto');\n    const { width, height, imageRatio } = dimensions;\n    \n    console.log(`ğŸ” ä½¿ç”¨å®½é«˜æ¯”: ${params.aspectRatio || 'auto'}ï¼Œè®¡ç®—å°ºå¯¸: ${width}x${height}`);\n\n    let abilities: Record<string, any> = {};\n    if (hasFilePath) {\n      abilities = {\n        \"blend\": {\n          \"type\": \"\",\n          \"id\": generateUuid(),\n          \"min_features\": [],\n          \"core_param\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            \"model\": actualModel,\n            \"prompt\": params.prompt + '##',\n            \"sample_strength\": params.sample_strength || 0.5,\n            \"image_ratio\": imageRatio,\n            \"large_image_info\": {\n              \"type\": \"\",\n              \"id\": generateUuid(),\n              \"height\": height,\n              \"width\": width,\n              \"resolution_type\": getResolutionType(width, height)\n            },\n            \"intelligent_ratio\": false\n          },\n          \"ability_list\": [\n            {\n              \"type\": \"\",\n              \"id\": generateUuid(),\n              \"name\": \"byte_edit\",\n              \"image_uri_list\": [uploadID],\n              \"image_list\": [\n                {\n                  \"type\": \"image\",\n                  \"id\": generateUuid(),\n                  \"source_from\": \"upload\",\n                  \"platform_type\": 1,\n                  \"name\": \"\",\n                  \"image_uri\": uploadID,\n                  \"width\": 0,\n                  \"height\": 0,\n                  \"format\": \"\",\n                  \"uri\": uploadID\n                }\n              ],\n              \"strength\": 0.5\n            }\n          ],\n          \"history_option\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n          },\n          \"prompt_placeholder_info_list\": [\n            {\n              \"type\": \"\",\n              \"id\": generateUuid(),\n              \"ability_index\": 0\n            }\n          ],\n          \"postedit_param\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            \"generate_type\": 0\n          }\n        }\n      }\n    } else {\n      abilities = {\n        \"generate\": {\n          \"type\": \"\",\n          \"id\": generateUuid(),\n          \"core_param\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            \"model\": actualModel,\n            \"prompt\": params.prompt,\n            \"negative_prompt\": params.negative_prompt || \"\",\n            \"seed\": Math.floor(Math.random() * 100000000) + 2500000000,\n            \"sample_strength\": params.sample_strength || 0.5,\n            \"image_ratio\": imageRatio,\n            \"large_image_info\": {\n              \"type\": \"\",\n              \"id\": generateUuid(),\n              \"height\": height,\n              \"width\": width,\n              \"resolution_type\": getResolutionType(width, height)\n            },\n            \"intelligent_ratio\": false\n          },\n          \"history_option\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n          }\n        }\n      }\n    }\n\n    const baseData: any = {\n      \"extend\": {\n        \"root_model\": actualModel,\n        \"template_id\": \"\",\n      },\n      \"submit_id\": generateUuid(),\n      \"metrics_extra\": hasFilePath ? undefined : jsonEncode({\n        \"templateId\": \"\",\n        \"generateCount\": 1,\n        \"promptSource\": \"custom\",\n        \"templateSource\": \"\",\n        \"lastRequestId\": \"\",\n        \"originRequestId\": \"\",\n      }),\n      \"draft_content\": jsonEncode({\n        \"type\": \"draft\",\n        \"id\": generateUuid(),\n        \"min_version\": DRAFT_VERSION,\n        \"is_from_tsn\": true,\n        \"version\": \"3.2.9\",\n        \"main_component_id\": componentId,\n        \"component_list\": [{\n          \"type\": \"image_base_component\",\n          \"id\": componentId,\n          \"min_version\": DRAFT_VERSION,\n          \"aigc_mode\": \"workbench\",\n          \"metadata\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            \"created_platform\": 3,\n            \"created_platform_version\": \"\",\n            \"created_time_in_ms\": Date.now(),\n            \"created_did\": \"\"\n          },\n          \"generate_type\": hasFilePath ? \"blend\" : \"generate\",\n          \"abilities\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            ...abilities\n          }\n        }]\n      }),\n    };\n\n    // å¦‚æœæ˜¯ç»§ç»­ç”Ÿæˆè¯·æ±‚ï¼Œæ·»åŠ ç‰¹æœ‰å­—æ®µ\n    if (isContinuation && historyId) {\n      baseData.action = 2;\n      baseData.history_id = historyId;\n    }\n\n    const rqParams = {\n      \"babi_param\": urlEncode(jsonEncode({\n        \"scenario\": \"image_video_generation\",\n        \"feature_key\": hasFilePath ? \"to_image_referenceimage_generate\" : \"aigc_to_image\",\n        \"feature_entrance\": \"to_image\",\n        \"feature_entrance_detail\": hasFilePath ? \"to_image-referenceimage-byte_edit\" : `to_image-${actualModel}`,\n      })),\n      \"aid\": parseInt(DEFAULT_ASSISTANT_ID),\n      \"device_platform\": \"web\",\n      \"region\": \"cn\",\n      \"webId\": WEB_ID,\n      \"web_component_open_flag\": 1\n    };\n\n    return {\n      rqData: baseData,\n      rqParams: rqParams\n    };\n  }\n\n  /**\n   * æ„å»ºæ™ºèƒ½å¤šå¸§è§†é¢‘ç”Ÿæˆè¯·æ±‚æ•°æ®\n   */\n  private async buildMultiFrameVideoRequest(params: VideoGenerationParams, actualModel: string): Promise<{ rqData: any, rqParams: any }> {\n    if (!params.multiFrames || params.multiFrames.length === 0) {\n      throw new Error('å¤šå¸§æ¨¡å¼éœ€è¦æä¾›multiFrameså‚æ•°');\n    }\n\n    // éªŒè¯å¸§æ•°é‡é™åˆ¶\n    if (params.multiFrames.length > 10) {\n      throw new Error(`æ™ºèƒ½å¤šå¸§æœ€å¤šæ”¯æŒ10å¸§ï¼Œå½“å‰æä¾›äº†${params.multiFrames.length}å¸§`);\n    }\n\n    // éªŒè¯æ¯ä¸ªå¸§çš„å‚æ•°\n    for (const frame of params.multiFrames) {\n      if (frame.duration_ms < 1000 || frame.duration_ms > 5000) {\n        throw new Error(`å¸§${frame.idx}çš„duration_mså¿…é¡»åœ¨1000-5000msèŒƒå›´å†…ï¼ˆ1-5ç§’ï¼‰`);\n      }\n    }\n\n    // å¤„ç†å¤šå¸§å›¾ç‰‡ä¸Šä¼ \n    const processedFrames = [];\n    for (const frame of params.multiFrames) {\n      const uploadID = await this.uploadCoverFile(frame.image_path);\n      processedFrames.push({\n        type: \"\",\n        id: generateUuid(),\n        idx: frame.idx,\n        duration_ms: frame.duration_ms,\n        prompt: frame.prompt,\n        media_info: {\n          type: \"\",\n          id: generateUuid(),\n          media_type: 1,\n          image_info: {\n            type: \"image\",\n            id: generateUuid(),\n            source_from: \"upload\",\n            platform_type: 1,\n            name: \"\",\n            image_uri: uploadID,\n            width: params.width || 864,\n            height: params.height || 1184,\n            format: \"\",\n            uri: uploadID\n          }\n        }\n      });\n    }\n\n    const componentId = generateUuid();\n    const metricsExtra = jsonEncode({\n      \"isDefaultSeed\": 1,\n      \"originSubmitId\": generateUuid(),\n      \"isRegenerate\": false,\n      \"enterFrom\": \"click\",\n      \"functionMode\": \"multi_frame\"\n    });\n\n    const rqParams: {\n      [key: string]: string | number\n    } = {\n      msToken: generateMsToken(),\n      aigc_features: \"app_lip_sync\",\n      web_version: \"6.6.0\",\n      \"da_version\": \"3.2.9\",\n      \"aid\": parseInt(DEFAULT_ASSISTANT_ID),\n      \"device_platform\": \"web\", \n      \"region\": \"cn\",\n      \"webId\": WEB_ID,\n      \"web_component_open_flag\": 1\n    };\n\n    rqParams['a_bogus'] = generate_a_bogus(toUrlParams(rqParams), UA);\n\n    const rqData = {\n      \"extend\": {\n        \"root_model\": actualModel,\n        \"m_video_commerce_info\": {\n          \"benefit_type\": \"basic_video_operation_vgfm_v_three\",\n          \"resource_id\": \"generate_video\", \n          \"resource_id_type\": \"str\",\n          \"resource_sub_type\": \"aigc\"\n        },\n        \"m_video_commerce_info_list\": [{\n          \"benefit_type\": \"basic_video_operation_vgfm_v_three\",\n          \"resource_id\": \"generate_video\",\n          \"resource_id_type\": \"str\", \n          \"resource_sub_type\": \"aigc\"\n        }]\n      },\n      \"submit_id\": generateUuid(),\n      \"metrics_extra\": metricsExtra,\n      \"draft_content\": jsonEncode({\n        \"type\": \"draft\",\n        \"id\": generateUuid(),\n        \"min_version\": \"3.0.5\",\n        \"min_features\": [\"AIGC_GenerateType_VideoMultiFrame\"],\n        \"is_from_tsn\": true,\n        \"version\": \"3.2.9\",\n        \"main_component_id\": componentId,\n        \"component_list\": [{\n          \"type\": \"video_base_component\",\n          \"id\": componentId,\n          \"min_version\": \"1.0.0\",\n          \"aigc_mode\": \"workbench\",\n          \"metadata\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            \"created_platform\": 3,\n            \"created_platform_version\": \"\",\n            \"created_time_in_ms\": Date.now().toString(),\n            \"created_did\": \"\"\n          },\n          \"generate_type\": \"gen_video\",\n          \"abilities\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            \"gen_video\": {\n              \"type\": \"\",\n              \"id\": generateUuid(),\n              \"text_to_video_params\": {\n                \"type\": \"\",\n                \"id\": generateUuid(),\n                \"video_gen_inputs\": [{\n                  \"type\": \"\",\n                  \"id\": generateUuid(),\n                  \"min_version\": \"3.0.5\",\n                  \"prompt\": params.prompt || \"\",\n                  \"video_mode\": 2,\n                  \"fps\": params.fps || 24,\n                  \"duration_ms\": params.duration_ms || 10000,\n                  \"resolution\": params.resolution || \"720p\",\n                  \"multi_frames\": processedFrames\n                }],\n                \"video_aspect_ratio\": params.video_aspect_ratio || \"3:4\",\n                \"seed\": Math.floor(Math.random() * 100000000) + 2500000000,\n                \"model_req_key\": actualModel,\n                \"priority\": 0\n              },\n              \"video_task_extra\": metricsExtra\n            }\n          }\n        }]\n      }),\n      \"http_common_info\": {\n        \"aid\": parseInt(DEFAULT_ASSISTANT_ID)\n      }\n    };\n\n    return {\n      rqData,\n      rqParams\n    };\n  }\n\n  /**\n   * å»é‡å›¾ç‰‡URLåˆ—è¡¨ï¼ŒåŸºäºå›¾ç‰‡ID\n   */\n  private deduplicateImageUrls(urls: string[]): string[] {\n    const seen = new Set<string>();\n    const uniqueUrls: string[] = [];\n    \n    for (const url of urls) {\n      // æå–å›¾ç‰‡IDï¼ˆURLä¸­çš„å…³é”®æ ‡è¯†ç¬¦ï¼‰\n      const match = url.match(/([a-f0-9]{32})/);\n      const imageId = match ? match[1] : url;\n      \n      if (!seen.has(imageId)) {\n        seen.add(imageId);\n        uniqueUrls.push(url);\n      }\n    }\n    \n    console.log(`ğŸ” å»é‡ç»“æœ: åŸå§‹${urls.length}å¼  -> å»é‡å${uniqueUrls.length}å¼ `);\n    return uniqueUrls;\n  }\n\n  /**\n   * ä»itemListä¸­æå–å›¾ç‰‡URL\n   */\n  private extractImageUrls(itemList: any[]): string[] {\n    console.log('ğŸ” itemList é¡¹ç›®æ•°é‡:', itemList?.length || 0);\n\n    // æå–å›¾ç‰‡URL - å°è¯•å¤šç§å¯èƒ½çš„è·¯å¾„\n    const resultList = (itemList || []).map((item, index) => {\n      console.log(`ğŸ” å¤„ç†ç¬¬${index}é¡¹:`, JSON.stringify(item, null, 2));\n      \n      // å°è¯•å¤šç§å¯èƒ½çš„URLè·¯å¾„\n      let imageUrl = item?.image?.large_images?.[0]?.image_url \n                  || item?.common_attr?.cover_url\n                  || item?.image?.url\n                  || item?.image?.image_url\n                  || item?.cover_url\n                  || item?.url;\n      \n      // å¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°è¯•åœ¨åµŒå¥—å¯¹è±¡ä¸­æŸ¥æ‰¾\n      if (!imageUrl && item?.image?.large_images) {\n        for (const img of item.image.large_images) {\n          if (img?.image_url || img?.url) {\n            imageUrl = img.image_url || img.url;\n            break;\n          }\n        }\n      }\n      \n      console.log(`ğŸ” æå–åˆ°çš„URL:`, imageUrl);\n      return imageUrl;\n    }).filter(Boolean)\n    \n    console.log('ğŸ” æœ¬è½®æå–çš„å›¾ç‰‡ç»“æœ:', resultList)\n    return resultList\n  }\n\n\n  /**\n   * æ‰©å±•çš„è½®è¯¢æ–¹æ³•ï¼Œè¿”å›æ›´å¤šè¯¦ç»†ä¿¡æ¯\n   * @param result åˆå§‹è¯·æ±‚ç»“æœ\n   * @param lastItemCount ä¸Šæ¬¡è½®è¯¢æ—¶çš„é¡¹ç›®æ•°é‡ï¼Œç”¨äºå¢é‡è¿”å›ï¼ˆå¯é€‰ï¼‰\n   */\n  async pollResultWithHistoryExtended(result: any, lastItemCount: number = 0): Promise<{ itemList: any[], recordData: any, needsContinuation: boolean }> {\n    // è·å–å†å²è®°å½•ID\n    const historyId = result?.data?.aigc_data?.history_record_id;\n    if (!historyId) {\n      if (result?.errmsg) {\n        throw new Error(result.errmsg);\n      } else {\n        throw new Error('è®°å½•IDä¸å­˜åœ¨');\n      }\n    }\n\n    // è½®è¯¢è·å–ç»“æœ\n    let status = 20;\n    let failCode = null;\n    let itemList: any[] = [];\n    let recordData: any = null;\n    let pollCount = 0;\n    let needsContinuation = false; // æ˜¯å¦éœ€è¦ç»§ç»­ç”Ÿæˆ\n    const maxPollCount = 20; // æœ€å¤šè½®è¯¢20æ¬¡\n\n    console.log('ğŸ” å¼€å§‹è½®è¯¢ï¼ŒhistoryId:', historyId);\n    \n    while ((status === 20 || status === 45 || status === 42) && pollCount < maxPollCount) {\n      pollCount++;\n      // æ ¹æ®çŠ¶æ€ç è°ƒæ•´ç­‰å¾…æ—¶é—´ï¼šstatus=45éœ€è¦æ›´é•¿ç­‰å¾…æ—¶é—´ï¼Œstatus=42å¯èƒ½æ˜¯é”™è¯¯æˆ–ç‰¹æ®Šå¤„ç†çŠ¶æ€\n      let waitTime;\n      if (status === 45) {\n        // status=45å¯èƒ½æ˜¯æ’é˜Ÿæˆ–å¤„ç†ä¸­ï¼Œéœ€è¦æ›´é•¿ç­‰å¾…æ—¶é—´\n        waitTime = pollCount === 1 ? 30000 : 10000; // ç¬¬ä¸€æ¬¡30ç§’ï¼Œåç»­10ç§’\n      } else if (status === 42) {\n        // status=42å¯èƒ½æ˜¯é”™è¯¯æˆ–ç‰¹æ®Šå¤„ç†çŠ¶æ€ï¼Œé€‚ä¸­çš„ç­‰å¾…æ—¶é—´\n        waitTime = pollCount === 1 ? 15000 : 8000; // ç¬¬ä¸€æ¬¡15ç§’ï¼Œåç»­8ç§’\n      } else {\n        // status=20æ­£å¸¸å¤„ç†ä¸­\n        waitTime = pollCount === 1 ? 20000 : 5000; // ç¬¬ä¸€æ¬¡20ç§’ï¼Œåç»­5ç§’\n      }\n      \n      console.log(`ğŸ” è½®è¯¢ç¬¬ ${pollCount} æ¬¡ï¼ŒçŠ¶æ€=${status}ï¼Œç­‰å¾… ${waitTime/1000} ç§’...`);\n      await new Promise(resolve => setTimeout(resolve, waitTime));\n\n      const result = await this.request(\n        'POST',\n        '/mweb/v1/get_history_by_ids',\n        {\n          \"history_ids\": [historyId],\n          \"image_info\": {\n            \"width\": 2048,\n            \"height\": 2048,\n            \"format\": \"webp\",\n            \"image_scene_list\": [\n              { \"scene\": \"smart_crop\", \"width\": 360, \"height\": 360, \"uniq_key\": \"smart_crop-w:360-h:360\", \"format\": \"webp\" },\n              { \"scene\": \"smart_crop\", \"width\": 480, \"height\": 480, \"uniq_key\": \"smart_crop-w:480-h:480\", \"format\": \"webp\" },\n              { \"scene\": \"smart_crop\", \"width\": 720, \"height\": 720, \"uniq_key\": \"smart_crop-w:720-h:720\", \"format\": \"webp\" },\n              { \"scene\": \"smart_crop\", \"width\": 720, \"height\": 480, \"uniq_key\": \"smart_crop-w:720-h:480\", \"format\": \"webp\" },\n              { \"scene\": \"smart_crop\", \"width\": 360, \"height\": 240, \"uniq_key\": \"smart_crop-w:360-h:240\", \"format\": \"webp\" },\n              { \"scene\": \"smart_crop\", \"width\": 240, \"height\": 320, \"uniq_key\": \"smart_crop-w:240-h:320\", \"format\": \"webp\" },\n              { \"scene\": \"smart_crop\", \"width\": 480, \"height\": 640, \"uniq_key\": \"smart_crop-w:480-h:640\", \"format\": \"webp\" },\n              { \"scene\": \"normal\", \"width\": 2400, \"height\": 2400, \"uniq_key\": \"2400\", \"format\": \"webp\" },\n              { \"scene\": \"normal\", \"width\": 1080, \"height\": 1080, \"uniq_key\": \"1080\", \"format\": \"webp\" },\n              { \"scene\": \"normal\", \"width\": 720, \"height\": 720, \"uniq_key\": \"720\", \"format\": \"webp\" },\n              { \"scene\": \"normal\", \"width\": 480, \"height\": 480, \"uniq_key\": \"480\", \"format\": \"webp\" },\n              { \"scene\": \"normal\", \"width\": 360, \"height\": 360, \"uniq_key\": \"360\", \"format\": \"webp\" }\n            ]\n          },\n          \"http_common_info\": {\n            \"aid\": parseInt(DEFAULT_ASSISTANT_ID)\n          }\n        }\n      );\n\n      const record = result?.data?.[historyId];\n      if (!record) {\n        throw new Error('è®°å½•ä¸å­˜åœ¨');\n      }\n      status = record.status;\n      failCode = record.fail_code;\n      recordData = record; // ä¿å­˜å®Œæ•´çš„è®°å½•æ•°æ®\n\n      console.log(`ğŸ” è½®è¯¢çŠ¶æ€: status=${status}, failCode=${failCode}, itemListé•¿åº¦=${record.item_list?.length || 0}`);\n      console.log(`ğŸ” è¯¦ç»†çŠ¶æ€: total_image_count=${record.total_image_count}, finished_image_count=${record.finished_image_count}, confirm_status=${record.confirm_status}`);\n\n      // æ£€æµ‹æ˜¯å¦éœ€è¦ç»§ç»­ç”Ÿæˆï¼šå½“total_image_count > 4æ—¶\n      const totalCount = record.total_image_count || 0;\n      if (totalCount > 4 && !needsContinuation) {\n        console.log('ğŸ” æ£€æµ‹åˆ°éœ€è¦ç”Ÿæˆè¶…è¿‡4å¼ å›¾ç‰‡ï¼Œæ ‡è®°éœ€è¦ç»§ç»­ç”Ÿæˆ');\n        needsContinuation = true;\n      }\n\n      if (status === 30) {\n        if (failCode === '2038') {\n          throw new Error('å†…å®¹è¢«è¿‡æ»¤');\n        }\n        throw new Error('ç”Ÿæˆå¤±è´¥');\n      }\n      \n      // æ£€æŸ¥æ˜¯å¦æœ¬è½®ç”Ÿæˆå®Œæˆï¼šç­‰å¾…è¾¾åˆ°æ‰¹æ¬¡å¤§å°æˆ–ç‰¹å®šçŠ¶æ€\n      if (record.item_list && record.item_list.length > 0) {\n        const currentItemList = record.item_list as any[];\n        const finishedCount = record.finished_image_count || 0;\n        const totalCount = record.total_image_count || 0;\n        \n        console.log(`ğŸ” å½“å‰çŠ¶æ€æ£€æŸ¥: item_listé•¿åº¦=${currentItemList.length}, finished_count=${finishedCount}, total_count=${totalCount}, status=${status}`);\n        \n        // æ£€æµ‹æ˜¯å¦ä¸ºè§†é¢‘ç”Ÿæˆï¼ˆé€šè¿‡finished_image_countå’Œtotal_image_countéƒ½ä¸º0æ¥åˆ¤æ–­ï¼‰\n        const isVideoGeneration = finishedCount === 0 && totalCount === 0 && currentItemList.length > 0;\n        \n        if (isVideoGeneration) {\n          console.log(`ğŸ” æ£€æµ‹åˆ°è§†é¢‘ç”Ÿæˆæ¨¡å¼: status=${status}, itemListé•¿åº¦=${currentItemList.length}`);\n        }\n        \n        // æŒ‰ç…§ç”¨æˆ·æŒ‡å¯¼ä¿®æ”¹åˆ¤æ–­é€»è¾‘ï¼šç­‰å¾…åˆé€‚çš„æ¡ä»¶æ‰æå–URL\n        const isBatchComplete = \n          // è§†é¢‘ç”Ÿæˆå®Œæˆæ¡ä»¶ï¼šstatus=50ä¸”æœ‰itemListé¡¹ç›®\n          (isVideoGeneration && status === 50 && currentItemList.length > 0) ||\n          // æ¡ä»¶1: è¾¾åˆ°äº†ä¸€ä¸ªæ‰¹æ¬¡çš„å¤§å°ï¼ˆ4å¼ å›¾ç‰‡ï¼‰ï¼Œä¸”çŠ¶æ€ç¨³å®š\n          (currentItemList.length >= 4 && status !== 20 && status !== 45 && status !== 42) ||\n          // æ¡ä»¶2: finished_image_countè¾¾åˆ°äº†total_image_countï¼ˆå…¨éƒ¨å®Œæˆï¼‰\n          (totalCount > 0 && finishedCount >= totalCount) ||\n          // æ¡ä»¶3: å¯¹äºå°æ‰¹æ¬¡ï¼ˆ<=4å¼ ï¼‰ï¼Œç­‰å¾…æ‰€æœ‰çŠ¶æ€æŒ‡ç¤ºå®Œæˆ\n          (totalCount > 0 && totalCount <= 4 && finishedCount >= totalCount && status !== 20) ||\n          // æ¡ä»¶4: å½“æ£€æµ‹åˆ°éœ€è¦ç»§ç»­ç”Ÿæˆä¸”å·²è¾¾åˆ°æ‰¹æ¬¡ä¸Šé™ï¼ˆ4å¼ ï¼‰æ—¶ï¼Œç«‹å³å®Œæˆå½“å‰æ‰¹æ¬¡\n          (needsContinuation && currentItemList.length >= 4 && finishedCount >= 4);\n          \n        if (isBatchComplete) {\n          // å®ç°å¢é‡è¿”å›ï¼šåªè¿”å›æ–°å¢çš„å›¾ç‰‡é¡¹ç›®\n          const incrementalItems = currentItemList.slice(lastItemCount);\n          \n          console.log('ğŸ” æœ¬è½®ç”Ÿæˆå®Œæˆï¼Œè¿”å›ç»“æœ');\n          console.log(`ğŸ” æ€»é¡¹ç›®æ•°: ${currentItemList.length}, ä¸Šæ¬¡æ•°é‡: ${lastItemCount}, æ–°å¢é¡¹ç›®: ${incrementalItems.length}`);\n          console.log(`ğŸ” å®Œæˆæ¡ä»¶: item_listé•¿åº¦=${currentItemList.length}, finished=${finishedCount}, total=${totalCount}, status=${status}`);\n          \n          return { itemList: incrementalItems, recordData, needsContinuation };\n        } else {\n          console.log('ğŸ” æœ¬è½®ç”Ÿæˆæœªå®Œæˆï¼Œç»§ç»­è½®è¯¢...');\n          console.log(`ğŸ” ç­‰å¾…æ¡ä»¶: item_listé•¿åº¦=${currentItemList.length}, finished=${finishedCount}, total=${totalCount}, status=${status}`);\n        }\n      }\n      \n      // å¦‚æœçŠ¶æ€ä¸å†æ˜¯å¤„ç†ä¸­ï¼Œä½†ä¹Ÿæ²¡æœ‰ç»“æœï¼Œå¯èƒ½éœ€è¦ç»§ç»­è½®è¯¢å…¶ä»–çŠ¶æ€\n      if (status !== 20 && status !== 45) {\n        console.log(`ğŸ” é‡åˆ°æ–°çŠ¶æ€ ${status}ï¼Œç»§ç»­è½®è¯¢...`);\n      }\n    }\n    \n    if (pollCount >= maxPollCount) {\n      console.log('ğŸ” è½®è¯¢è¶…æ—¶ï¼Œä½†çŠ¶æ€ä»ä¸º20ï¼Œè¿”å›ç©ºæ•°ç»„');\n    }\n    return { itemList: [], recordData, needsContinuation }\n  }\n\n  async pollResultWithHistory(result: any): Promise<any[]> {\n    const extendedResult = await this.pollResultWithHistoryExtended(result, 0);\n    return extendedResult.itemList;\n  }\n  /**\n  * è·å–ä¸Šä¼ å‡­è¯æ‰€éœ€Akå’ŒTk\n  */\n  private async getUploadAuth(): Promise<any> {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const authRes = await this.request(\n          'POST',\n          '/mweb/v1/get_upload_token?aid=513695&da_version=3.2.2&aigc_features=app_lip_sync',\n          {\n            scene: 2\n          },\n          {},\n        );\n        if (\n          !authRes.data\n        ) {\n          reject(authRes.errmsg ?? 'è·å–ä¸Šä¼ å‡­è¯å¤±è´¥,è´¦å·å¯èƒ½å·²æ‰çº¿!');\n          return;\n        }\n        resolve(authRes.data);\n      } catch (err) {\n        console.error('è·å–ä¸Šä¼ å‡­è¯å¤±è´¥:', err);\n        reject(err);\n      }\n    });\n  }\n\n  public async getFileContent(filePath: string): Promise<Buffer> {\n    try {\n      if (filePath.includes('https://') || filePath.includes('http://')) {\n        // ç›´æ¥ç”¨axiosè·å–å›¾ç‰‡Buffer\n        const res = await axios.get(filePath, { responseType: 'arraybuffer' });\n        return Buffer.from(res.data);\n      } else {\n        // ç¡®ä¿è·¯å¾„æ˜¯ç»å¯¹è·¯å¾„\n        const absolutePath = path.resolve(filePath);\n        // è¯»å–æ–‡ä»¶å†…å®¹\n        return await fs.promises.readFile(absolutePath);\n      }\n    } catch (error) {\n      console.error('Failed to read file:', error);\n      throw new Error(`è¯»å–æ–‡ä»¶å¤±è´¥: filePath`);\n    }\n  }\n\n  private generateRandomString(length: number): string {\n    let result = '';\n    const characters = 'abcdefghijklmnopqrstuvwxyz0123456789';\n    const charactersLength = characters.length;\n    for (let i = 0; i < length; i++) {\n      result += characters.charAt(Math.floor(Math.random() * charactersLength));\n    }\n    return result;\n  }\n\n  /**\n  * ç”Ÿæˆè¯·æ±‚æ‰€éœ€Header\n  */\n  private addHeaders(\n    amzDate: string,\n    sessionToken: string,\n    requestBody: any,\n  ): any {\n    const headers = {\n      'X-Amz-Date': amzDate,\n      'X-Amz-Security-Token': sessionToken,\n    };\n    if (Object.keys(requestBody).length > 0) {\n      // @ts-ignore\n      headers['X-Amz-Content-Sha256'] = crypto\n        .createHash('sha256')\n        .update(JSON.stringify(requestBody))\n        .digest('hex');\n    }\n    return headers;\n  }\n\n  /**\n   * ç”Ÿæˆè¯·æ±‚æ‰€éœ€Header\n   */\n  private async generateAuthorizationAndHeader(\n    accessKeyID: string,\n    secretAccessKey: string,\n    sessionToken: string,\n    region: string,\n    service: string,\n    requestMethod: string,\n    requestParams: any,\n    requestBody: any = {},\n  ): Promise<any> {\n    return new Promise((resolve) => {\n      // è·å–å½“å‰ISOæ—¶é—´\n      const now = new Date();\n      const amzDate = now.toISOString().replace(/[:\\-]|\\.\\d{3}/g, '').slice(0, 15) + 'Z';\n\n      // ç”Ÿæˆè¯·æ±‚çš„Header\n      const requestHeaders: Record<string, string> = this.addHeaders(\n        amzDate,\n        sessionToken,\n        requestBody,\n      )\n\n      if (Object.keys(requestBody).length > 0) {\n        // @ts-ignore\n        requestHeaders['X-Amz-Content-Sha256'] = crypto\n          .createHash('sha256')\n          .update(JSON.stringify(requestBody))\n          .digest('hex')\n      }\n      // ç”Ÿæˆè¯·æ±‚çš„Authorization\n      const authorizationParams = [\n        'AWS4-HMAC-SHA256 Credential=' + accessKeyID + '/' +\n        this.credentialString(amzDate, region, service),\n        'SignedHeaders=' + this.signedHeaders(requestHeaders),\n        'Signature=' + this.signature(\n          secretAccessKey,\n          amzDate,\n          region,\n          service,\n          requestMethod,\n          requestParams,\n          requestHeaders,\n          requestBody,\n        ),\n      ];\n      const authorization = authorizationParams.join(', ');\n\n      // è¿”å›Headers\n      const headers: any = {};\n      for (const key in requestHeaders) {\n        headers[key] = requestHeaders[key];\n      }\n      headers['Authorization'] = authorization;\n      resolve(headers);\n    });\n  }\n\n  /**\n   * è·å–credentialString\n   */\n  private credentialString(\n    amzDate: string,\n    region: string,\n    service: string,\n  ): string {\n    const credentialArr = [\n      amzDate.substring(0, 8),\n      region,\n      service,\n      'aws4_request',\n    ];\n    return credentialArr.join('/');\n  }\n\n  /**\n   * ç”Ÿæˆhttpè¯·æ±‚å‚æ•°å­—ç¬¦ä¸²\n   */\n  private httpBuildQuery(params: any): string {\n    const searchParams = new URLSearchParams();\n    for (const key in params) {\n      if (params?.hasOwnProperty(key)) {\n        searchParams.append(key, params[key]);\n      }\n    }\n    return searchParams.toString();\n  }\n\n  private signedHeaders(requestHeaders: any): string {\n    const headers: string[] = [];\n    Object.keys(requestHeaders).forEach(function (r) {\n      r = r.toLowerCase();\n      headers.push(r);\n    });\n    return headers.sort().join(';');\n  }\n\n\n  /**\n   * ç”ŸæˆcanonicalString\n   */\n  private canonicalString(\n    requestMethod: string,\n    requestParams: any,\n    requestHeaders: any,\n    requestBody: any,\n  ): string {\n    let canonicalHeaders: string[] = [];\n    const headerKeys = Object.keys(requestHeaders).sort();\n    for (let i = 0; i < headerKeys.length; i++) {\n      canonicalHeaders.push(\n        headerKeys[i].toLowerCase() + ':' + requestHeaders[headerKeys[i]],\n      );\n    }\n    // @ts-ignore\n    canonicalHeaders = canonicalHeaders.join('\\n') + '\\n';\n    let body = '';\n    if (Object.keys(requestBody).length > 0) {\n      body = JSON.stringify(requestBody);\n    }\n\n    const canonicalStringArr = [\n      requestMethod.toUpperCase(),\n      '/',\n      this.httpBuildQuery(requestParams),\n      canonicalHeaders,\n      this.signedHeaders(requestHeaders),\n      crypto.createHash('sha256').update(body).digest('hex'),\n    ];\n    return canonicalStringArr.join('\\n');\n  }\n\n  private signature(\n    secretAccessKey: string,\n    amzDate: string,\n    region: string,\n    service: string,\n    requestMethod: string,\n    requestParams: any,\n    requestHeaders: any,\n    requestBody: any,\n  ): string {\n    // ç”ŸæˆsigningKey\n    const amzDay = amzDate.substring(0, 8);\n    const kDate = crypto\n      .createHmac('sha256', 'AWS4' + secretAccessKey)\n      .update(amzDay)\n      .digest();\n    const kRegion = crypto.createHmac('sha256', kDate).update(region).digest();\n    const kService = crypto\n      .createHmac('sha256', kRegion)\n      .update(service)\n      .digest();\n    const signingKey = crypto\n      .createHmac('sha256', kService)\n      .update('aws4_request')\n      .digest();\n\n    // ç”ŸæˆStringToSign\n    const stringToSignArr = [\n      'AWS4-HMAC-SHA256',\n      amzDate,\n      this.credentialString(amzDate, region, service),\n      crypto\n        .createHash('sha256')\n        .update(\n          this.canonicalString(\n            requestMethod,\n            requestParams,\n            requestHeaders,\n            requestBody,\n          ),\n        )\n        .digest('hex'),\n    ];\n    const stringToSign = stringToSignArr.join('\\n');\n    return crypto\n      .createHmac('sha256', signingKey)\n      .update(stringToSign)\n      .digest('hex');\n  }\n\n  /**\n   * ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨\n   * @param url ä¸Šä¼ åœ°å€\n   * @param fileContent æ–‡ä»¶å†…å®¹\n   * @param headers è¯·æ±‚å¤´\n   * @param method HTTP æ–¹æ³•\n   * @param proxy\n   */\n  private async uploadFile(\n    url: string,\n    fileContent: Buffer,\n    headers: any,\n    method: string = 'PUT',\n  ): Promise<any> {\n    return new Promise(async (resolve, reject) => {\n      const res = await this.request(\n        'POST',\n        url,\n        fileContent,\n        {},\n        headers\n      );\n      resolve(res);\n    });\n  }\n\n  /**\n   * ä¸Šä¼ æ–‡ä»¶\n   */\n  private async uploadCoverFile(\n    filePath: string,\n  ): Promise<string> {\n    return new Promise(async (resolve, reject) => {\n      try {\n        console.log('å¼€å§‹ä¸Šä¼ æ–‡ä»¶:', filePath);\n        // è·å–ä¸Šä¼ ä»¤ç‰Œæ‰€éœ€Akå’ŒTk\n        const uploadAuth = await this.getUploadAuth();\n\n        // è·å–å›¾ç‰‡æ•°æ®\n        const imageRes = await this.getFileContent(filePath);\n        // è·å–å›¾ç‰‡Crc32æ ‡è¯†\n        const imageCrc32 = crc32(imageRes).toString(16);\n        // è·å–å›¾ç‰‡ä¸Šä¼ å‡­è¯ç­¾åæ‰€éœ€å‚æ•°\n        const getUploadImageProofRequestParams = {\n          Action: 'ApplyImageUpload',\n          FileSize: imageRes.length,\n          ServiceId: 'tb4s082cfz',\n          Version: '2018-08-01',\n          s: this.generateRandomString(11),\n        };\n\n        // è·å–å›¾ç‰‡ä¸Šä¼ è¯·æ±‚å¤´\n        const requestHeadersInfo = await this.generateAuthorizationAndHeader(\n          uploadAuth.access_key_id,\n          uploadAuth.secret_access_key,\n          uploadAuth.session_token,\n          'cn-north-1',\n          'imagex',\n          'GET',\n          getUploadImageProofRequestParams,\n        );\n\n\n        // è·å–å›¾ç‰‡ä¸Šä¼ å‡­è¯\n        const uploadImgRes = await this.request(\n          'GET',\n          this.getUploadImageProofUrl + '?' +\n          this.httpBuildQuery(getUploadImageProofRequestParams),\n          {},\n          {},\n          requestHeadersInfo\n        );\n\n        if (uploadImgRes?.['Response  ']?.hasOwnProperty('Error')) {\n          reject(uploadImgRes['Response ']['Error']['Message']);\n          return;\n        }\n\n        const UploadAddress = uploadImgRes.Result.UploadAddress;\n        // ç”¨å‡­è¯æ‹¼æ¥ä¸Šä¼ å›¾ç‰‡æ¥å£\n        const uploadImgUrl = `https://${UploadAddress.UploadHosts[0]}/upload/v1/${UploadAddress.StoreInfos[0].StoreUri}`;\n\n        // ä¸Šä¼ å›¾ç‰‡\n        const imageUploadRes = await this.uploadFile(\n          uploadImgUrl,\n          imageRes,\n          {\n            Authorization: UploadAddress.StoreInfos[0].Auth,\n            'Content-Crc32': imageCrc32,\n            'Content-Type': 'application/octet-stream',\n            // 'X-Storage-U': '3674996648187204',\n          },\n          'POST',\n        );\n\n\n        if (imageUploadRes.code !== 2000) {\n          reject(imageUploadRes.message);\n          return;\n        }\n\n        const commitImgParams = {\n          Action: 'CommitImageUpload',\n          FileSize: imageRes.length,\n          ServiceId: 'tb4s082cfz',\n          Version: '2018-08-01',\n          // user_id: userUid,\n        };\n\n        const commitImgContent = {\n          SessionKey: UploadAddress.SessionKey,\n        };\n\n        const commitImgHead = await this.generateAuthorizationAndHeader(\n          uploadAuth.access_key_id,\n          uploadAuth.secret_access_key,\n          uploadAuth.session_token,\n          'cn-north-1',\n          'imagex',\n          'POST',\n          commitImgParams,\n          commitImgContent,\n        );\n\n        // æäº¤å›¾ç‰‡ä¸Šä¼ \n        const commitImg = await this.request(\n          'POST',\n          this.getUploadImageProofUrl +\n          '?' +\n          this.httpBuildQuery(commitImgParams),\n          commitImgContent,\n          {},\n          {\n            ...commitImgHead,\n            'Content-Type': 'application/json',\n          }\n        );\n\n        if (commitImg['Response ']?.hasOwnProperty('Error')) {\n          reject(commitImg['Response  ']['Error']['Message']);\n          return;\n        }\n\n\n        resolve(commitImg.Result.Results[0].Uri);\n      } catch (err: any) {\n        console.error('ä¸Šä¼ æ–‡ä»¶å¤±è´¥:', err);\n        const errorMessage = err?.message || err || 'æœªçŸ¥';\n        reject('ä¸Šä¼ å¤±è´¥,å¤±è´¥åŸå› :' + errorMessage);\n      }\n    });\n  }\n\n  /**\n   * ç”Ÿæˆæ™ºèƒ½å¤šå¸§è§†é¢‘\n   */\n  private async generateMultiFrameVideo(params: VideoGenerationParams, actualModel: string): Promise<string> {\n    console.log('ğŸ” å¼€å§‹æ™ºèƒ½å¤šå¸§è§†é¢‘ç”Ÿæˆ...');\n    \n    // ä½¿ç”¨å¤šå¸§è¯·æ±‚æ„å»ºå™¨\n    const { rqData, rqParams } = await this.buildMultiFrameVideoRequest(params, actualModel);\n    \n    console.log('ğŸ” å¤šå¸§è§†é¢‘ç”Ÿæˆè¯·æ±‚å‚æ•°:', {\n      model: actualModel,\n      frameCount: params.multiFrames?.length,\n      aspectRatio: params.video_aspect_ratio,\n      duration: params.duration_ms\n    });\n    \n    // å‘é€ç”Ÿæˆè¯·æ±‚\n    const result = await this.request(\n      'POST',\n      '/mweb/v1/aigc_draft/generate',\n      rqData,\n      rqParams\n    );\n\n    // ä½¿ç”¨æ‰©å±•çš„è½®è¯¢æ–¹æ³•æ¥è·å–è¯¦ç»†æ•°æ®\n    const pollResult = await this.pollResultWithHistoryExtended(result, 0);\n    const itemList = pollResult.itemList;\n    \n    // ä¿å­˜å®Œæ•´çš„è§†é¢‘è¿”å›æ•°æ®åˆ°æ–‡ä»¶ä¸­ä»¥ä¾›åˆ†æ\n    const debugData = {\n      timestamp: new Date().toISOString(),\n      requestType: 'multiframe-video',\n      actualModel,\n      pollResult: itemList,\n      originalResult: result,\n      recordData: pollResult.recordData\n    };\n    \n    const fs = await import('fs');\n    const debugFileName = `debug-jimeng-video-response-${Date.now()}.json`;\n    fs.writeFileSync(debugFileName, JSON.stringify(debugData, null, 2));\n    console.log('ğŸ” å®Œæ•´è§†é¢‘è¿”å›æ•°æ®å·²ä¿å­˜åˆ°:', debugFileName);\n    \n    // å°è¯•å¤šç§å¯èƒ½çš„è§†é¢‘URLè·¯å¾„\n    let videoUrl;\n    if (itemList && itemList.length > 0) {\n      const item = itemList[0];\n      console.log('ğŸ” æ£€æŸ¥è§†é¢‘æ•°æ®ç»“æ„ keys:', Object.keys(item || {}));\n      \n      // å°è¯•ä¸åŒçš„URLè·¯å¾„\n      videoUrl = item?.video?.transcoded_video?.origin?.video_url ||\n                item?.video?.video_url ||\n                item?.video?.origin?.video_url ||\n                item?.common_attr?.cover_url ||\n                item?.aigc_video_params?.video_url ||\n                item?.url ||\n                item?.video_url;\n      \n      console.log('ğŸ” å°è¯•çš„URLè·¯å¾„ç»“æœ:', {\n        'video?.transcoded_video?.origin?.video_url': item?.video?.transcoded_video?.origin?.video_url,\n        'video?.video_url': item?.video?.video_url,\n        'video?.origin?.video_url': item?.video?.origin?.video_url,\n        'common_attr?.cover_url': item?.common_attr?.cover_url,\n        'aigc_video_params?.video_url': item?.aigc_video_params?.video_url,\n        'url': item?.url,\n        'video_url': item?.video_url\n      });\n      \n      // å¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°URLï¼Œå°è¯•æ·±åº¦éå†\n      if (!videoUrl && item?.video) {\n        console.log('ğŸ” æ·±åº¦æ£€æŸ¥ video å¯¹è±¡ keys:', Object.keys(item.video || {}));\n        if (item.video.transcoded_video) {\n          console.log('ğŸ” æ£€æŸ¥ transcoded_video keys:', Object.keys(item.video.transcoded_video || {}));\n        }\n      }\n    } else {\n      console.log('ğŸ” è­¦å‘Š: itemListä¸ºç©ºæˆ–é•¿åº¦ä¸º0');\n    }\n    \n    console.log('ğŸ” å¤šå¸§è§†é¢‘ç”Ÿæˆç»“æœ:', videoUrl);\n    return videoUrl;\n  }\n\n  async generateVideo(params: VideoGenerationParams): Promise<string> {\n    if (!params.prompt || typeof params.prompt !== 'string') {\n      throw new Error('promptå¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²');\n    }\n    \n    // æ£€æµ‹æ˜¯å¦ä¸ºå¤šå¸§æ¨¡å¼\n    const isMultiFrameMode = params.multiFrames && params.multiFrames.length > 0;\n    const modelName = params.model || (isMultiFrameMode ? 'jimeng-video-multiframe' : DEFAULT_VIDEO_MODEL);\n    const actualModel = this.getModel(modelName);\n    \n    console.log(`ğŸ” è§†é¢‘ç”Ÿæˆæ¨¡å¼: ${isMultiFrameMode ? 'æ™ºèƒ½å¤šå¸§' : 'ä¼ ç»Ÿæ¨¡å¼'}`);\n    console.log(`ğŸ” ä½¿ç”¨æ¨¡å‹: ${modelName} -> ${actualModel}`);\n    \n    // æ£€æŸ¥ç§¯åˆ†\n    const creditInfo = await this.getCredit();\n    if (creditInfo.totalCredit <= 0) {\n      await this.receiveCredit();\n    }\n    \n    // æ ¹æ®æ¨¡å¼é€‰æ‹©ä¸åŒçš„å¤„ç†é€»è¾‘\n    if (isMultiFrameMode) {\n      return this.generateMultiFrameVideo(params, actualModel);\n    }\n    \n    // ä¼ ç»Ÿå•å¸§/é¦–å°¾å¸§æ¨¡å¼çš„å¤„ç†é€»è¾‘ä¿æŒä¸å˜\n    let first_frame_image = undefined\n    let end_frame_image = undefined\n    if (params?.filePath) {\n      let uploadIDs: any[] = []\n      for (const item of params.filePath) {\n        const uploadID = await this.uploadCoverFile(item)\n        uploadIDs.push(uploadID)\n      }\n      if (uploadIDs[0]) {\n        first_frame_image = {\n          format: \"\",\n          height: params.height || 1024,\n          id: generateUuid(),\n          image_uri: uploadIDs[0],\n          name: \"\",\n          platform_type: 1,\n          source_from: \"upload\",\n          type: \"image\",\n          uri: uploadIDs[0],\n          width: params.width || 1024,\n        }\n      }\n      if (uploadIDs[1]) {\n        end_frame_image = {\n          format: \"\",\n          height: params.height || 1024,\n          id: generateUuid(),\n          image_uri: uploadIDs[1],\n          name: \"\",\n          platform_type: 1,\n          source_from: \"upload\",\n          type: \"image\",\n          uri: uploadIDs[1],\n          width: params.width || 1024,\n        }\n      }\n      if (!first_frame_image && !end_frame_image) {\n        throw new Error('ä¸Šä¼ å°é¢å›¾ç‰‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥å›¾ç‰‡è·¯å¾„æ˜¯å¦æ­£ç¡®');\n      }\n    }\n    const componentId = generateUuid();\n    const metricsExtra = jsonEncode({\n      \"enterFrom\": \"click\",\n      \"isDefaultSeed\": 1,\n      \"promptSource\": \"custom\",\n      \"isRegenerate\": false,\n      \"originSubmitId\": generateUuid(),\n    })\n    const rqParams: {\n      [key: string]: string | number\n    } = {\n      msToken: generateMsToken(),\n      aigc_features: \"app_lip_sync\",\n      web_version: \"6.6.0\",\n      \"da_version\": \"3.2.9\",\n      \"aid\": parseInt(DEFAULT_ASSISTANT_ID),\n      \"device_platform\": \"web\",\n      \"region\": \"cn\",\n      \"webId\": WEB_ID,\n      \"web_component_open_flag\": 1\n    }\n    rqParams['a_bogus'] = generate_a_bogus(toUrlParams(rqParams), UA)\n    const rqData = {\n      \"extend\": {\n        \"root_model\": end_frame_image ? MODEL_MAP['jimeng-video-3.0'] : actualModel,\n        \"m_video_commerce_info\": {\n          benefit_type: \"basic_video_operation_vgfm_v_three\",\n          resource_id: \"generate_video\",\n          resource_id_type: \"str\",\n          resource_sub_type: \"aigc\"\n        },\n        \"m_video_commerce_info_list\": [{\n          benefit_type: \"basic_video_operation_vgfm_v_three\",\n          resource_id: \"generate_video\",\n          resource_id_type: \"str\",\n          resource_sub_type: \"aigc\"\n        }]\n      },\n      \"submit_id\": generateUuid(),\n      \"metrics_extra\": metricsExtra,\n      \"draft_content\": jsonEncode({\n        \"type\": \"draft\",\n        \"id\": generateUuid(),\n        \"min_version\": \"3.0.5\",\n        \"is_from_tsn\": true,\n        \"version\": \"3.2.8\",\n        \"main_component_id\": componentId,\n        \"component_list\": [{\n          \"type\": \"video_base_component\",\n          \"id\": componentId,\n          \"min_version\": \"1.0.0\",\n          \"metadata\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            \"created_platform\": 3,\n            \"created_platform_version\": \"\",\n            \"created_time_in_ms\": Date.now(),\n            \"created_did\": \"\"\n          },\n          \"generate_type\": \"gen_video\",\n          \"aigc_mode\": \"workbench\",\n          \"abilities\": {\n            \"type\": \"\",\n            \"id\": generateUuid(),\n            \"gen_video\": {\n              \"id\": generateUuid(),\n              \"type\": \"\",\n              \"text_to_video_params\": {\n                \"type\": \"\",\n                \"id\": generateUuid(),\n                \"model_req_key\": actualModel,\n                \"priority\": 0,\n                \"seed\": Math.floor(Math.random() * 100000000) + 2500000000,\n                \"video_aspect_ratio\": \"1:1\",\n                \"video_gen_inputs\": [{\n                  duration_ms: 5000,\n                  first_frame_image: first_frame_image,\n                  end_frame_image: end_frame_image,\n                  fps: 24,\n                  id: generateUuid(),\n                  min_version: \"3.0.5\",\n                  prompt: params.prompt,\n                  resolution: params.resolution || \"720p\",\n                  type: \"\",\n                  video_mode: 2\n                }]\n              },\n              \"video_task_extra\": metricsExtra,\n            }\n          }\n        }],\n      }),\n    }\n    // å‘é€ç”Ÿæˆè¯·æ±‚\n    const result = await this.request(\n      'POST',\n      '/mweb/v1/aigc_draft/generate',\n      rqData,\n      rqParams\n    );\n\n    const itemList = await this.pollResultWithHistory(result);\n    const videoUrl = itemList?.[0]?.video?.transcoded_video?.origin?.video_url\n    console.log('ç”Ÿæˆè§†é¢‘ç»“æœ:', videoUrl);\n\n    return videoUrl;\n  }\n\n  /**\n   * è§†é¢‘è¡¥å¸§æ–¹æ³• - å°†ä½å¸§ç‡è§†é¢‘æå‡è‡³30fpsæˆ–60fps\n   * \n   * åŠŸèƒ½è¯´æ˜ï¼š\n   * - å¯¹å·²ç”Ÿæˆçš„è§†é¢‘è¿›è¡Œå¸§æ’å€¼å¤„ç†ï¼Œæå‡è§†é¢‘æ’­æ”¾æµç•…åº¦\n   * - æ”¯æŒ24fpsâ†’30fpsæˆ–24fpsâ†’60fpsçš„å¸§ç‡æå‡\n   * - ä½¿ç”¨AIæŠ€æœ¯ç”Ÿæˆä¸­é—´å¸§ï¼Œä¿æŒè§†é¢‘å†…å®¹è¿è´¯æ€§\n   * \n   * @param params è¡¥å¸§å‚æ•°\n   * @param params.videoId åŸå§‹è§†é¢‘ID\n   * @param params.originHistoryId åŸå§‹ç”Ÿæˆå†å²ID\n   * @param params.targetFps ç›®æ ‡å¸§ç‡ï¼Œæ”¯æŒ30æˆ–60\n   * @param params.originFps åŸå§‹è§†é¢‘å¸§ç‡\n   * @param params.duration è§†é¢‘æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼Œå¯é€‰\n   * @returns å¤„ç†åçš„é«˜å¸§ç‡è§†é¢‘URL\n   */\n  async frameInterpolation(params: FrameInterpolationParams): Promise<string> {\n    console.log('ğŸ¬ å¼€å§‹è§†é¢‘è¡¥å¸§å¤„ç†...');\n    console.log(`ğŸ“‹ è¡¥å¸§å‚æ•°: ${params.originFps}fps -> ${params.targetFps}fps`);\n    \n    // æ£€æŸ¥ç§¯åˆ†\n    const creditInfo = await this.getCredit();\n    if (creditInfo.totalCredit <= 0) {\n      await this.receiveCredit();\n    }\n\n    // ç”ŸæˆåŸºç¡€å‚æ•°\n    const submitId = generateUuid();\n    const modelKey = this.getModel('jimeng-video-multiframe');\n    const metricsExtra = JSON.stringify({\n      promptSource: \"custom\",\n      isDefaultSeed: 1,\n      originSubmitId: submitId,\n      enterFrom: \"click\",\n      isRegenerate: false,\n      functionMode: \"multi_frame\"\n    });\n\n    const draftContent = {\n      type: \"draft\",\n      id: generateUuid(),\n      min_version: \"3.1.0\",\n      min_features: [\"AIGC_GenerateType_VideoInsertFrame\", \"AIGC_GenerateType_VideoMultiFrame\"],\n      is_from_tsn: true,\n      version: \"3.2.9\",\n      main_component_id: generateUuid(),\n      component_list: [{\n        type: \"video_base_component\",\n        id: generateUuid(),\n        min_version: \"1.0.0\",\n        aigc_mode: \"workbench\",\n        metadata: {\n          type: \"\",\n          id: generateUuid(),\n          created_platform: 3,\n          created_platform_version: \"\",\n          created_time_in_ms: Date.now().toString(),\n          created_did: \"\"\n        },\n        generate_type: \"gen_video\",\n        abilities: {\n          type: \"\",\n          id: generateUuid(),\n          gen_video: {\n            type: \"\",\n            id: generateUuid(),\n            text_to_video_params: {\n              type: \"\",\n              id: generateUuid(),\n              video_gen_inputs: [{\n                type: \"\",\n                id: generateUuid(),\n                min_version: \"3.0.5\",\n                prompt: \"è§†é¢‘è¡¥å¸§å¤„ç†\",\n                lens_motion_type: \"\",\n                motion_speed: \"\",\n                vid: params.videoId,\n                video_mode: 2,\n                fps: params.originFps,\n                duration_ms: params.duration || 10000,\n                template_id: 0,\n                v2v_opt: {\n                  type: \"\",\n                  id: generateUuid(),\n                  min_version: \"3.1.0\",\n                  insert_frame: {\n                    type: \"\",\n                    id: generateUuid(),\n                    enable: true,\n                    target_fps: params.targetFps,\n                    origin_fps: params.originFps,\n                    duration_ms: params.duration || 10000\n                  }\n                },\n                origin_history_id: params.originHistoryId,\n                resolution: \"720p\"\n              }]\n            },\n            scene: \"insert_frame\",\n            video_task_extra: metricsExtra,\n            video_ref_params: {\n              type: \"\",\n              id: generateUuid(),\n              generate_type: 0,\n              item_id: parseInt(params.videoId.replace('v', '')),\n              origin_history_id: params.originHistoryId\n            }\n          },\n          process_type: 3\n        }\n      }]\n    };\n\n    const requestData = {\n      extend: {\n        root_model: modelKey,\n        m_video_commerce_info: {\n          benefit_type: \"video_frame_interpolation\",\n          resource_id: \"generate_video\",\n          resource_id_type: \"str\",\n          resource_sub_type: \"aigc\"\n        },\n        m_video_commerce_info_list: [{\n          benefit_type: \"video_frame_interpolation\", \n          resource_id: \"generate_video\",\n          resource_id_type: \"str\",\n          resource_sub_type: \"aigc\"\n        }]\n      },\n      submit_id: submitId,\n      metrics_extra: metricsExtra,\n      draft_content: JSON.stringify(draftContent),\n      http_common_info: { aid: 513695 }\n    };\n\n    // æ„å»ºè¯·æ±‚å‚æ•°\n    const rqParams: any = {\n      \"babi_param\": urlEncode(jsonEncode({\n        \"scenario\": \"image_video_generation\",\n        \"feature_key\": \"aigc_to_video\", \n        \"feature_entrance\": \"to_video\",\n        \"feature_entrance_detail\": \"to_video-jimeng-video-multiframe\"\n      })),\n      \"aid\": parseInt(DEFAULT_ASSISTANT_ID),\n      \"device_platform\": \"web\",\n      \"region\": \"cn\",\n      \"webId\": WEB_ID,\n      \"web_component_open_flag\": 1\n    };\n    rqParams['a_bogus'] = generate_a_bogus(toUrlParams(rqParams), UA);\n\n    // å‘é€è¡¥å¸§è¯·æ±‚\n    const result = await this.request(\n      'POST',\n      '/mweb/v1/aigc_draft/generate',\n      requestData,\n      rqParams\n    );\n\n    console.log('ğŸ” å¼€å§‹è½®è¯¢è¡¥å¸§ç»“æœ...');\n    const pollResult = await this.pollResultWithHistoryExtended(result);\n    const itemList = pollResult.itemList;\n    \n    // æå–è§†é¢‘URL\n    let videoUrl;\n    if (itemList && itemList.length > 0) {\n      const item = itemList[0];\n      videoUrl = item?.video?.transcoded_video?.origin?.video_url ||\n                item?.video?.video_url ||\n                item?.common_attr?.cover_url;\n    }\n\n    console.log('ğŸ¬ è¡¥å¸§å¤„ç†å®Œæˆ:', videoUrl);\n    return videoUrl;\n  }\n\n  /**\n   * è§†é¢‘åˆ†è¾¨ç‡æå‡æ–¹æ³• - å°†ä½åˆ†è¾¨ç‡è§†é¢‘æå‡è‡³æ›´é«˜åˆ†è¾¨ç‡\n   * \n   * åŠŸèƒ½è¯´æ˜ï¼š\n   * - å¯¹å·²ç”Ÿæˆçš„è§†é¢‘è¿›è¡Œè¶…åˆ†è¾¨ç‡å¤„ç†ï¼Œæå‡è§†é¢‘ç”»è´¨å’Œæ¸…æ™°åº¦\n   * - æ”¯æŒå°†è§†é¢‘åˆ†è¾¨ç‡æå‡è‡³åŸæ¥çš„2å€æˆ–æ›´é«˜ï¼ˆå¦‚704x1248 â†’ 1408x2496ï¼‰\n   * - ä½¿ç”¨AIæŠ€æœ¯é‡å»ºè§†é¢‘ç»†èŠ‚ï¼Œä¿æŒç”»é¢è´¨é‡å’Œå†…å®¹å®Œæ•´æ€§\n   * \n   * @param params åˆ†è¾¨ç‡æå‡å‚æ•°\n   * @param params.videoId åŸå§‹è§†é¢‘ID\n   * @param params.originHistoryId åŸå§‹ç”Ÿæˆå†å²ID  \n   * @param params.targetWidth ç›®æ ‡å®½åº¦\n   * @param params.targetHeight ç›®æ ‡é«˜åº¦\n   * @param params.originWidth åŸå§‹å®½åº¦\n   * @param params.originHeight åŸå§‹é«˜åº¦\n   * @returns å¤„ç†åçš„é«˜åˆ†è¾¨ç‡è§†é¢‘URL\n   */\n  async superResolution(params: SuperResolutionParams): Promise<string> {\n    console.log('ğŸ¨ å¼€å§‹è§†é¢‘åˆ†è¾¨ç‡æå‡å¤„ç†...');\n    console.log(`ğŸ“‹ åˆ†è¾¨ç‡æå‡: ${params.originWidth}x${params.originHeight} -> ${params.targetWidth}x${params.targetHeight}`);\n    \n    // æ£€æŸ¥ç§¯åˆ†\n    const creditInfo = await this.getCredit();\n    if (creditInfo.totalCredit <= 0) {\n      await this.receiveCredit();\n    }\n\n    // ç”ŸæˆåŸºç¡€å‚æ•°\n    const submitId = generateUuid();\n    const modelKey = this.getModel('jimeng-video-multiframe');\n    const metricsExtra = JSON.stringify({\n      promptSource: \"custom\",\n      isDefaultSeed: 1,\n      originSubmitId: submitId,\n      enterFrom: \"click\",\n      isRegenerate: false,\n      functionMode: \"multi_frame\"\n    });\n\n    const draftContent = {\n      type: \"draft\",\n      id: generateUuid(),\n      min_version: \"3.1.0\",\n      min_features: [\"AIGC_GenerateType_VideoSuperResolution\", \"AIGC_GenerateType_VideoMultiFrame\"],\n      is_from_tsn: true,\n      version: \"3.2.9\",\n      main_component_id: generateUuid(),\n      component_list: [{\n        type: \"video_base_component\",\n        id: generateUuid(),\n        min_version: \"1.0.0\",\n        aigc_mode: \"workbench\",\n        metadata: {\n          type: \"\",\n          id: generateUuid(),\n          created_platform: 3,\n          created_platform_version: \"\",\n          created_time_in_ms: Date.now().toString(),\n          created_did: \"\"\n        },\n        generate_type: \"gen_video\",\n        abilities: {\n          type: \"\",\n          id: generateUuid(),\n          gen_video: {\n            type: \"\",\n            id: generateUuid(),\n            text_to_video_params: {\n              type: \"\",\n              id: generateUuid(),\n              video_gen_inputs: [{\n                type: \"\",\n                id: generateUuid(),\n                min_version: \"3.0.5\",\n                prompt: \"è§†é¢‘åˆ†è¾¨ç‡æå‡å¤„ç†\",\n                lens_motion_type: \"\",\n                motion_speed: \"\",\n                vid: params.videoId,\n                video_mode: 2,\n                fps: 24,\n                duration_ms: 10000,\n                template_id: 0,\n                v2v_opt: {\n                  type: \"\",\n                  id: generateUuid(),\n                  min_version: \"3.1.0\",\n                  super_resolution: {\n                    type: \"\",\n                    id: generateUuid(),\n                    enable: true,\n                    target_width: params.targetWidth,\n                    target_height: params.targetHeight,\n                    origin_width: params.originWidth,\n                    origin_height: params.originHeight\n                  }\n                },\n                origin_history_id: params.originHistoryId,\n                resolution: \"720p\"\n              }]\n            },\n            scene: \"super_resolution\",\n            video_task_extra: metricsExtra,\n            video_ref_params: {\n              type: \"\",\n              id: generateUuid(),\n              generate_type: 0,\n              item_id: parseInt(params.videoId.replace('v', '')),\n              origin_history_id: params.originHistoryId\n            }\n          },\n          process_type: 2\n        }\n      }]\n    };\n\n    const requestData = {\n      extend: {\n        root_model: modelKey,\n        m_video_commerce_info: {\n          benefit_type: \"video_upscale\",\n          resource_id: \"generate_video\", \n          resource_id_type: \"str\",\n          resource_sub_type: \"aigc\"\n        },\n        m_video_commerce_info_list: [{\n          benefit_type: \"video_upscale\",\n          resource_id: \"generate_video\",\n          resource_id_type: \"str\", \n          resource_sub_type: \"aigc\"\n        }]\n      },\n      submit_id: submitId,\n      metrics_extra: metricsExtra,\n      draft_content: JSON.stringify(draftContent),\n      http_common_info: { aid: 513695 }\n    };\n\n    // æ„å»ºè¯·æ±‚å‚æ•°\n    const rqParams: any = {\n      \"babi_param\": urlEncode(jsonEncode({\n        \"scenario\": \"image_video_generation\",\n        \"feature_key\": \"aigc_to_video\",\n        \"feature_entrance\": \"to_video\", \n        \"feature_entrance_detail\": \"to_video-jimeng-video-multiframe\"\n      })),\n      \"aid\": parseInt(DEFAULT_ASSISTANT_ID),\n      \"device_platform\": \"web\",\n      \"region\": \"cn\",\n      \"webId\": WEB_ID,\n      \"web_component_open_flag\": 1\n    };\n    rqParams['a_bogus'] = generate_a_bogus(toUrlParams(rqParams), UA);\n\n    // å‘é€åˆ†è¾¨ç‡æå‡è¯·æ±‚\n    const result = await this.request(\n      'POST',\n      '/mweb/v1/aigc_draft/generate',\n      requestData,\n      rqParams\n    );\n\n    console.log('ğŸ” å¼€å§‹è½®è¯¢åˆ†è¾¨ç‡æå‡ç»“æœ...');\n    const pollResult = await this.pollResultWithHistoryExtended(result);\n    const itemList = pollResult.itemList;\n    \n    // æå–è§†é¢‘URL\n    let videoUrl;\n    if (itemList && itemList.length > 0) {\n      const item = itemList[0];\n      videoUrl = item?.video?.transcoded_video?.origin?.video_url ||\n                item?.video?.video_url ||\n                item?.common_attr?.cover_url;\n    }\n\n    console.log('ğŸ¨ åˆ†è¾¨ç‡æå‡å®Œæˆ:', videoUrl);\n    return videoUrl;\n  }\n\n}\n\n// åˆ›å»ºAPIå®¢æˆ·ç«¯å®ä¾‹ï¼Œç¡®ä¿ç¯å¢ƒå˜é‡æ­£ç¡®åŠ è½½\nconst getApiClient = () => {\n  const token = process.env.JIMENG_API_TOKEN;\n  console.log('ğŸ” [API Client Factory] Creating API client instance');\n  console.log('ğŸ” [API Client Factory] Environment token available:', !!token);\n  \n  if (!token) {\n    console.error('ğŸ” [API Client Factory] WARNING: JIMENG_API_TOKEN not found in environment variables');\n    console.error('ğŸ” [API Client Factory] Available env vars starting with JIMENG:', \n      Object.keys(process.env).filter(key => key.startsWith('JIMENG')));\n  }\n  \n  return new JimengApiClient(token);\n};\n\n// å»¶è¿Ÿåˆå§‹åŒ–APIå®¢æˆ·ç«¯å®ä¾‹\nlet apiClient: JimengApiClient | null = null;\n\n\n// å¯¼å‡ºå‡½æ•°ï¼Œä¿æŒå¯¹å¤–æ¥å£ä¸å˜\n\n/**\n * ç”ŸæˆAIå›¾åƒ\n * @param params å›¾åƒç”Ÿæˆå‚æ•°\n * @returns è¿”å›ç”Ÿæˆçš„å›¾åƒURLæ•°ç»„\n */\nexport const generateImage = (params: ImageGenerationParams): Promise<string[]> => {\n  // ğŸ” Debug logging - è®°å½•APIå…¥å£å‚æ•°\n  console.log('ğŸ” [API Export] generateImage called with params:', JSON.stringify({\n    filePath: params.filePath,\n    prompt: params.prompt ? `${params.prompt.substring(0, 100)}...` : undefined,\n    model: params.model,\n    aspectRatio: params.aspectRatio,\n    sample_strength: params.sample_strength,\n    negative_prompt: params.negative_prompt,\n    refresh_token: params.refresh_token ? '[PROVIDED]' : '[MISSING]'\n  }, null, 2));\n\n  // å»¶è¿Ÿåˆå§‹åŒ–APIå®¢æˆ·ç«¯\n  if (!apiClient) {\n    console.log('ğŸ” [API Export] Initializing API client on first use');\n    apiClient = getApiClient();\n  }\n\n  // ğŸ” Debug logging - æ£€æŸ¥APIå®¢æˆ·ç«¯å®ä¾‹çŠ¶æ€\n  console.log('ğŸ” [API Export] API Client instance available:', !!apiClient);\n  \n  return apiClient.generateImage(params);\n};\n\n/**\n * ç”ŸæˆAIè§†é¢‘\n * æ”¯æŒä¼ ç»Ÿæ¨¡å¼ï¼ˆé¦–å°¾å¸§ï¼‰å’Œæ™ºèƒ½å¤šå¸§æ¨¡å¼\n * @param params è§†é¢‘ç”Ÿæˆå‚æ•°\n * @returns è¿”å›ç”Ÿæˆçš„è§†é¢‘URL\n */\nexport const generateVideo = (params: VideoGenerationParams): Promise<string> => {\n  // å»¶è¿Ÿåˆå§‹åŒ–APIå®¢æˆ·ç«¯\n  if (!apiClient) {\n    console.log('ğŸ” [API Export] Initializing API client for generateVideo');\n    apiClient = getApiClient();\n  }\n  \n  return apiClient.generateVideo(params)\n}\n\n// è§†é¢‘åå¤„ç†å‚æ•°æ¥å£\nexport interface VideoPostProcessParams {\n  videoId: string;\n  originHistoryId: string;\n}\n\nexport interface FrameInterpolationParams extends VideoPostProcessParams {\n  targetFps: 30 | 60;\n  originFps: number;\n  duration?: number;\n}\n\nexport interface SuperResolutionParams extends VideoPostProcessParams {\n  targetWidth: number; // èŒƒå›´768-2560åƒç´ \n  targetHeight: number; // èŒƒå›´768-2560åƒç´ \n  originWidth: number;\n  originHeight: number;\n}\n\n/**\n * è§†é¢‘è¡¥å¸§æ“ä½œ\n * å°†ä½å¸§ç‡è§†é¢‘æå‡è‡³30fpsæˆ–60fpsï¼Œæå‡è§†é¢‘æµç•…åº¦\n * @param params è¡¥å¸§å‚æ•°ï¼ŒåŒ…å«è§†é¢‘IDã€ç›®æ ‡å¸§ç‡ç­‰ä¿¡æ¯\n * @returns è¿”å›å¤„ç†åçš„é«˜å¸§ç‡è§†é¢‘URL\n */\nexport const frameInterpolation = (params: FrameInterpolationParams): Promise<string> => {\n  // å»¶è¿Ÿåˆå§‹åŒ–APIå®¢æˆ·ç«¯\n  if (!apiClient) {\n    console.log('ğŸ” [API Export] Initializing API client for frameInterpolation');\n    apiClient = getApiClient();\n  }\n  \n  return apiClient.frameInterpolation(params);\n};\n\n/**\n * è§†é¢‘åˆ†è¾¨ç‡æå‡æ“ä½œ\n * å°†ä½åˆ†è¾¨ç‡è§†é¢‘æå‡è‡³æ›´é«˜åˆ†è¾¨ç‡ï¼Œå¢å¼ºè§†é¢‘ç”»è´¨\n * @param params åˆ†è¾¨ç‡æå‡å‚æ•°ï¼ŒåŒ…å«åŸå§‹å’Œç›®æ ‡åˆ†è¾¨ç‡ä¿¡æ¯\n * @returns è¿”å›å¤„ç†åçš„é«˜åˆ†è¾¨ç‡è§†é¢‘URL\n */\nexport const superResolution = (params: SuperResolutionParams): Promise<string> => {\n  // å»¶è¿Ÿåˆå§‹åŒ–APIå®¢æˆ·ç«¯\n  if (!apiClient) {\n    console.log('ğŸ” [API Export] Initializing API client for superResolution');\n    apiClient = getApiClient();\n  }\n  \n  return apiClient.superResolution(params);\n};\n\n// å¯¼å‡ºæ¥å£å®šä¹‰ï¼Œä»¥ä¾¿å…¶ä»–æ¨¡å—ä½¿ç”¨\nexport type { ImageGenerationParams, LogoInfo, VideoGenerationParams };\n","// from https://github.com/NearHuiwen/TiktokDouyinCrawler/blob/main/utils/a_bogus.js\n// All the content in this article is only for learning and communication use, not for any other purpose, strictly prohibited for commercial use and illegal use, otherwise all the consequences are irrelevant to the author!\n\nfunction rc4_encrypt(plaintext: string, key: string): string {\n    const s: number[] = [];\n    for (let i = 0; i < 256; i++) {\n        s[i] = i;\n    }\n    let j = 0;\n    for (let i = 0; i < 256; i++) {\n        j = (j + s[i] + key.charCodeAt(i % key.length)) % 256;\n        [s[i], s[j]] = [s[j], s[i]];\n    }\n\n    let i = 0;\n    j = 0;\n    const cipher: string[] = [];\n    for (let k = 0; k < plaintext.length; k++) {\n        i = (i + 1) % 256;\n        j = (j + s[i]) % 256;\n        [s[i], s[j]] = [s[j], s[i]];\n        const t = (s[i] + s[j]) % 256;\n        cipher.push(String.fromCharCode(s[t] ^ plaintext.charCodeAt(k)));\n    }\n    return cipher.join('');\n}\n\nfunction le(e: number, r: number): number {\n    r %= 32;\n    return ((e << r) | (e >>> (32 - r))) >>> 0;\n}\n\nfunction de(e: number): number | undefined {\n    if (0 <= e && e < 16) return 2043430169;\n    if (16 <= e && e < 64) return 2055708042;\n    console.error(\"invalid j for constant Tj\");\n    return undefined;\n}\n\nfunction pe(e: number, r: number, t: number, n: number): number {\n    if (0 <= e && e < 16) return (r ^ t ^ n) >>> 0;\n    if (16 <= e && e < 64) return (r & t | r & n | t & n) >>> 0;\n    console.error('invalid j for bool function FF');\n    return 0;\n}\n\nfunction he(e: number, r: number, t: number, n: number): number {\n    if (0 <= e && e < 16) return (r ^ t ^ n) >>> 0;\n    if (16 <= e && e < 64) return (r & t | ~r & n) >>> 0;\n    console.error('invalid j for bool function GG');\n    return 0;\n}\n\nfunction reset(this: SM3): void {\n    this.reg[0] = 1937774191;\n    this.reg[1] = 1226093241;\n    this.reg[2] = 388252375;\n    this.reg[3] = 3666478592;\n    this.reg[4] = 2842636476;\n    this.reg[5] = 372324522;\n    this.reg[6] = 3817729613;\n    this.reg[7] = 2969243214;\n    this.chunk = [];\n    this.size = 0;\n}\n\nfunction write(this: SM3, e: string | number[]): void {\n    const a: number[] = typeof e === \"string\"\n        ? (() => {\n            let n = encodeURIComponent(e).replace(/%([0-9A-F]{2})/g, (_, r) => String.fromCharCode(parseInt(r, 16)));\n            const arr = new Array(n.length);\n            Array.prototype.forEach.call(n, (ch: string, idx: number) => {\n                arr[idx] = ch.charCodeAt(0);\n            });\n            return arr;\n        })()\n        : e;\n    this.size += a.length;\n    let f = 64 - this.chunk.length;\n    if (a.length < f) {\n        this.chunk = this.chunk.concat(a);\n    } else {\n        this.chunk = this.chunk.concat(a.slice(0, f));\n        while (this.chunk.length >= 64) {\n            this._compress(this.chunk);\n            if (f < a.length) {\n                this.chunk = a.slice(f, Math.min(f + 64, a.length));\n            } else {\n                this.chunk = [];\n            }\n            f += 64;\n        }\n    }\n}\n\nfunction se(str: string, len: number, pad: string): string {\n    return pad.repeat(len - str.length) + str;\n}\n\nfunction sum(this: SM3, e?: string | number[], t?: 'hex'): string | number[] {\n    if (e) {\n        this.reset();\n        this.write(e);\n    }\n    this._fill();\n    for (let f = 0; f < this.chunk.length; f += 64) {\n        this._compress(this.chunk.slice(f, f + 64));\n    }\n    let i: string | number[] | null = null;\n    if (t === 'hex') {\n        i = \"\";\n        for (let f = 0; f < 8; f++) {\n            i += se(this.reg[f].toString(16), 8, \"0\");\n        }\n    } else {\n        i = new Array(32);\n        for (let f = 0; f < 8; f++) {\n            let c = this.reg[f];\n            i[4 * f + 3] = (255 & c) >>> 0;\n            c >>>= 8;\n            i[4 * f + 2] = (255 & c) >>> 0;\n            c >>>= 8;\n            i[4 * f + 1] = (255 & c) >>> 0;\n            c >>>= 8;\n            i[4 * f] = (255 & c) >>> 0;\n        }\n    }\n    this.reset();\n    return i!;\n}\n\nfunction _compress(this: SM3, t: Array<number>): void {\n    if (t.length < 64) {\n        console.error(\"compress error: not enough data\");\n    } else {\n        const f = (() => {\n            const r = new Array(132);\n            for (let idx = 0; idx < 16; idx++) {\n                r[idx] = idx * 4 < t.length ? t[idx * 4] << 24 : 0;\n                r[idx] |= idx * 4 + 1 < t.length ? t[idx * 4 + 1] << 16 : 0;\n                r[idx] |= idx * 4 + 2 < t.length ? t[idx * 4 + 2] << 8 : 0;\n                r[idx] |= idx * 4 + 3 < t.length ? t[idx * 4 + 3] : 0;\n                r[idx] >>>= 0;\n            }\n            for (let n = 16; n < 68; n++) {\n                let a = r[n - 16] ^ r[n - 9] ^ le(r[n - 3], 15);\n                a = a ^ le(a, 15) ^ le(a, 23);\n                r[n] = (a ^ le(r[n - 13], 7) ^ r[n - 6]) >>> 0;\n            }\n            for (let n = 0; n < 64; n++) {\n                r[n + 68] = (r[n] ^ r[n + 4]) >>> 0;\n            }\n            return r;\n        })();\n        const i = this.reg.slice(0);\n        for (let c = 0; c < 64; c++) {\n            let o = le(i[0], 12) + i[4] + le(de(c)!, c);\n            let s = ((o = le((4294967295 & o) >>> 0, 7)) ^ le(i[0], 12)) >>> 0;\n            let u = pe(c, i[0], i[1], i[2]);\n            u = (4294967295 & (u + i[3] + s + f[c + 68])) >>> 0;\n            let b = he(c, i[4], i[5], i[6]);\n            b = (4294967295 & (b + i[7] + o + f[c])) >>> 0;\n            i[3] = i[2];\n            i[2] = le(i[1], 9);\n            i[1] = i[0];\n            i[0] = u;\n            i[7] = i[6];\n            i[6] = le(i[5], 19);\n            i[5] = i[4];\n            i[4] = (b ^ le(b, 9) ^ le(b, 17)) >>> 0;\n        }\n        for (let l = 0; l < 8; l++) {\n            this.reg[l] = (this.reg[l] ^ i[l]) >>> 0;\n        }\n    }\n}\n\nfunction _fill(this: SM3): void {\n    const a = 8 * this.size;\n    let f = this.chunk.push(128) % 64;\n    if (64 - f < 8) f -= 64;\n    while (f < 56) {\n        this.chunk.push(0);\n        f++;\n    }\n    for (let i = 0; i < 4; i++) {\n        const c = Math.floor(a / 4294967296);\n        this.chunk.push((c >>> (8 * (3 - i))) & 255);\n    }\n    for (let i = 0; i < 4; i++) {\n        this.chunk.push((a >>> (8 * (3 - i))) & 255);\n    }\n}\n\nclass SM3 {\n    reg: number[];\n    chunk: number[];\n    size: number;\n    constructor() {\n        this.reg = [];\n        this.chunk = [];\n        this.size = 0;\n        this.reset();\n    }\n    reset = reset;\n    write = write;\n    sum = sum;\n    _compress = _compress;\n    _fill = _fill;\n}\n\n// Move s_obj outside the function for proper type inference\nconst s_obj = {\n    s0: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n    s1: \"Dkdpgh4ZKsQB80/Mfvw36XI1R25+WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=\",\n    s2: \"Dkdpgh4ZKsQB80/Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe=\",\n    s3: \"ckdp1h4ZKsUB80/Mfvw36XIgR25+WQAlEi7NLboqYTOPuzmFjJnryx9HVGDaStCe\",\n    s4: \"Dkdpgh2ZmsQB80/MfvV36XI1R45-WUAlEixNLwoqYTOPuzKFjJnry79HbGcaStCe\"\n};\n\nfunction result_encrypt(long_str: string, num: keyof typeof s_obj | null = null): string {\n    const constant = {\n        \"0\": 16515072,\n        \"1\": 258048,\n        \"2\": 4032,\n        \"str\": num ? s_obj[num] : s_obj[\"s0\"],\n    };\n\n    let result = \"\";\n    let lound = 0;\n    let long_int = get_long_int(lound, long_str);\n    for (let i = 0; i < Math.floor(long_str.length / 3 * 4); i++) {\n        if (Math.floor(i / 4) !== lound) {\n            lound += 1;\n            long_int = get_long_int(lound, long_str);\n        }\n        let key = i % 4;\n        let temp_int: number;\n        switch (key) {\n            case 0:\n                temp_int = (long_int & constant[\"0\"]) >> 18;\n                result += constant[\"str\"].charAt(temp_int);\n                break;\n            case 1:\n                temp_int = (long_int & constant[\"1\"]) >> 12;\n                result += constant[\"str\"].charAt(temp_int);\n                break;\n            case 2:\n                temp_int = (long_int & constant[\"2\"]) >> 6;\n                result += constant[\"str\"].charAt(temp_int);\n                break;\n            case 3:\n                temp_int = long_int & 63;\n                result += constant[\"str\"].charAt(temp_int);\n                break;\n            default:\n                break;\n        }\n    }\n    return result;\n}\n\nfunction get_long_int(round: number, long_str: string): number {\n    round = round * 3;\n    return (long_str.charCodeAt(round) << 16) | (long_str.charCodeAt(round + 1) << 8) | (long_str.charCodeAt(round + 2));\n}\n\nfunction gener_random(random: number, option: number[]): number[] {\n    return [\n        ((random & 255 & 170) | (option[0] & 85)), // 163\n        ((random & 255 & 85) | (option[0] & 170)), //87\n        ((random >> 8 & 255 & 170) | (option[1] & 85)), //37\n        ((random >> 8 & 255 & 85) | (option[1] & 170)), //41\n    ];\n}\n\nfunction generate_rc4_bb_str(\n    url_search_params: string,\n    user_agent: string,\n    window_env_str: string,\n    suffix = \"cus\",\n    Arguments: number[] = [0, 1, 14]\n): string {\n    const sm3 = new SM3();\n    const start_time = Date.now();\n\n    // url_search_paramsä¸¤æ¬¡sm3ä¹‹çš„ç»“æœ\n    const url_search_params_list = sm3.sum(sm3.sum(url_search_params + suffix)) as number[];\n    // å¯¹åç¼€ä¸¤æ¬¡sm3ä¹‹çš„ç»“æœ\n    const cus = sm3.sum(sm3.sum(suffix)) as number[];\n    // å¯¹uaå¤„ç†ä¹‹åçš„ç»“æœ\n    const ua = sm3.sum(result_encrypt(rc4_encrypt(user_agent, String.fromCharCode(0.00390625, 1, 14)), \"s3\")) as number[];\n\n    const end_time = Date.now();\n    const b: { [key: number]: any } = {\n        8: 3,\n        10: end_time,\n        15: {\n            \"aid\": 6383,\n            \"pageId\": 6241,\n            \"boe\": false,\n            \"ddrt\": 7,\n            \"paths\": {\n                \"include\": [{}, {}, {}, {}, {}, {}, {}],\n                \"exclude\": []\n            },\n            \"track\": {\n                \"mode\": 0,\n                \"delay\": 300,\n                \"paths\": []\n            },\n            \"dump\": true,\n            \"rpU\": \"\"\n        },\n        16: start_time,\n        18: 44,\n        19: [1, 0, 1, 5],\n    };\n\n    b[20] = (b[16] >> 24) & 255;\n    b[21] = (b[16] >> 16) & 255;\n    b[22] = (b[16] >> 8) & 255;\n    b[23] = b[16] & 255;\n    b[24] = (b[16] / 256 / 256 / 256 / 256) >> 0;\n    b[25] = (b[16] / 256 / 256 / 256 / 256 / 256) >> 0;\n\n    b[26] = (Arguments[0] >> 24) & 255;\n    b[27] = (Arguments[0] >> 16) & 255;\n    b[28] = (Arguments[0] >> 8) & 255;\n    b[29] = Arguments[0] & 255;\n\n    b[30] = (Arguments[1] / 256) & 255;\n    b[31] = (Arguments[1] % 256) & 255;\n    b[32] = (Arguments[1] >> 24) & 255;\n    b[33] = (Arguments[1] >> 16) & 255;\n\n    b[34] = (Arguments[2] >> 24) & 255;\n    b[35] = (Arguments[2] >> 16) & 255;\n    b[36] = (Arguments[2] >> 8) & 255;\n    b[37] = Arguments[2] & 255;\n\n    b[38] = url_search_params_list[21];\n    b[39] = url_search_params_list[22];\n\n    b[40] = cus[21];\n    b[41] = cus[22];\n\n    b[42] = ua[23];\n    b[43] = ua[24];\n\n    b[44] = (b[10] >> 24) & 255;\n    b[45] = (b[10] >> 16) & 255;\n    b[46] = (b[10] >> 8) & 255;\n    b[47] = b[10] & 255;\n    b[48] = b[8];\n    b[49] = (b[10] / 256 / 256 / 256 / 256) >> 0;\n    b[50] = (b[10] / 256 / 256 / 256 / 256 / 256) >> 0;\n\n    b[51] = b[15]['pageId'];\n    b[52] = (b[15]['pageId'] >> 24) & 255;\n    b[53] = (b[15]['pageId'] >> 16) & 255;\n    b[54] = (b[15]['pageId'] >> 8) & 255;\n    b[55] = b[15]['pageId'] & 255;\n\n    b[56] = b[15]['aid'];\n    b[57] = b[15]['aid'] & 255;\n    b[58] = (b[15]['aid'] >> 8) & 255;\n    b[59] = (b[15]['aid'] >> 16) & 255;\n    b[60] = (b[15]['aid'] >> 24) & 255;\n\n    const window_env_list: number[] = [];\n    for (let index = 0; index < window_env_str.length; index++) {\n        window_env_list.push(window_env_str.charCodeAt(index));\n    }\n    b[64] = window_env_list.length;\n    b[65] = b[64] & 255;\n    b[66] = (b[64] >> 8) & 255;\n\n    b[69] = [].length;\n    b[70] = b[69] & 255;\n    b[71] = (b[69] >> 8) & 255;\n\n    b[72] = b[18] ^ b[20] ^ b[26] ^ b[30] ^ b[38] ^ b[40] ^ b[42] ^ b[21] ^ b[27] ^ b[31] ^ b[35] ^ b[39] ^ b[41] ^ b[43] ^ b[22] ^\n        b[28] ^ b[32] ^ b[36] ^ b[23] ^ b[29] ^ b[33] ^ b[37] ^ b[44] ^ b[45] ^ b[46] ^ b[47] ^ b[48] ^ b[49] ^ b[50] ^ b[24] ^\n        b[25] ^ b[52] ^ b[53] ^ b[54] ^ b[55] ^ b[57] ^ b[58] ^ b[59] ^ b[60] ^ b[65] ^ b[66] ^ b[70] ^ b[71];\n\n    let bb: number[] = [\n        b[18], b[20], b[52], b[26], b[30], b[34], b[58], b[38], b[40], b[53], b[42], b[21], b[27], b[54], b[55], b[31],\n        b[35], b[57], b[39], b[41], b[43], b[22], b[28], b[32], b[60], b[36], b[23], b[29], b[33], b[37], b[44], b[45],\n        b[59], b[46], b[47], b[48], b[49], b[50], b[24], b[25], b[65], b[66], b[70], b[71]\n    ];\n    bb = bb.concat(window_env_list).concat(b[72]);\n    return rc4_encrypt(String.fromCharCode(...bb), String.fromCharCode(121));\n}\n\nfunction generate_random_str(): string {\n    let random_str_list: number[] = [];\n    random_str_list = random_str_list.concat(gener_random(Math.random() * 10000, [3, 45]));\n    random_str_list = random_str_list.concat(gener_random(Math.random() * 10000, [1, 0]));\n    random_str_list = random_str_list.concat(gener_random(Math.random() * 10000, [1, 5]));\n    return String.fromCharCode(...random_str_list);\n}\n\nexport function generate_a_bogus(url_search_params: string, user_agent: string): string {\n    const result_str = generate_random_str() + generate_rc4_bb_str(\n        url_search_params,\n        user_agent,\n        \"1536|747|1536|834|0|30|0|0|1536|834|1536|864|1525|747|24|24|Win32\"\n    );\n    return result_encrypt(result_str, \"s4\") + \"=\";\n}\n\n//æµ‹è¯•è°ƒç”¨\n// console.log(generate_a_bogus(\n//     \"device_platform=webapp&aid=6383&channel=channel_pc_web&update_version_code=170400&pc_client_type=1&version_code=170400&version_name=17.4.0&cookie_enabled=true&screen_width=1536&screen_height=864&browser_language=zh-CN&browser_platform=Win32&browser_name=Chrome&browser_version=123.0.0.0&browser_online=true&engine_name=Blink&engine_version=123.0.0.0&os_name=Windows&os_version=10&cpu_core_num=16&device_memory=8&platform=PC&downlink=10&effective_type=4g&round_trip_time=50&webid=7362810250930783783&msToken=VkDUvz1y24CppXSl80iFPr6ez-3FiizcwD7fI1OqBt6IICq9RWG7nCvxKb8IVi55mFd-wnqoNkXGnxHrikQb4PuKob5Q-YhDp5Um215JzlBszkUyiEvR\",\n//     \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36\"\n// ));\n","\nimport { v4 as uuidv4 } from 'uuid';\n\nexport function toUrlParams(obj: Record<string, any>): string {\n  const params = new URLSearchParams()\n\n  Object.entries(obj).forEach(([key, value]) => {\n    if (value !== undefined && value !== null) {\n      if (Array.isArray(value)) {\n        value.forEach(v => params.append(key, String(v)))\n      } else {\n        params.append(key, String(value))\n      }\n    }\n  })\n\n  return params.toString()\n}\n\n\nexport const generateMsToken = (randomlength = 128) => {\n  const baseStr = 'ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789='\n  let random_str = ''\n  const length = baseStr.length - 1\n  for (let i = 0; i < randomlength; i++) {\n    random_str += baseStr[Math.floor(Math.random() * length)]\n  }\n  return random_str\n}\n\n\nexport const generateUuid = (): string => {\n  return uuidv4();\n};\n\nexport const jsonEncode = (obj: any): string => {\n  return JSON.stringify(obj);\n};\n\nexport const urlEncode = (str: string): string => {\n  return encodeURI(str);\n};\n\nexport const unixTimestamp = () => {\n  return parseInt(`${Date.now() / 1000}`);\n}"],"mappings":"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","names":["i","uuidv4","path","axios","_a","fs","dimensions","width","height","imageRatio","result","totalCount","crc32","_a"]}